{
  "metadata": {
    "name": "cicd-java-main-finance-b38758a4-hhjbb",
    "generateName": "cicd-java-main-finance-b38758a4-",
    "namespace": "argo-workflows",
    "uid": "40b8604f-dc71-487c-860b-ca891e0a4c70",
    "resourceVersion": "26452413",
    "generation": 17,
    "creationTimestamp": "2026-01-20T14:28:05Z",
    "labels": {
      "branch": "main",
      "events.argoproj.io/action-timestamp": "1768458297241",
      "events.argoproj.io/sensor": "cicd-sensor",
      "events.argoproj.io/trigger": "gitlab-workflow-main",
      "project_id": "7",
      "repository": "finance",
      "workflows.argoproj.io/completed": "true",
      "workflows.argoproj.io/creator": "2a55ea4f-4623-4622-a5b4-d631623e2109",
      "workflows.argoproj.io/creator-preferred-username": "admin",
      "workflows.argoproj.io/phase": "Failed",
      "workflows.argoproj.io/resubmitted-from-workflow": "cicd-java-main-finance-b38758a4-l68lq"
    },
    "annotations": {
      "trigger.workflows.job/AUTHOR": "Eric",
      "trigger.workflows.job/CHECKOUT_SHA": "b38758a4d38cd25468a9ab11c888a9b4bbc318b2",
      "workflows.argoproj.io/pod-name-format": "v2"
    },
    "managedFields": [
      {
        "manager": "argo",
        "operation": "Update",
        "apiVersion": "argoproj.io/v1alpha1",
        "time": "2026-01-20T14:33:07Z",
        "fieldsType": "FieldsV1",
        "fieldsV1": {
          "f:metadata": {
            "f:annotations": {
              ".": {},
              "f:trigger.workflows.job/AUTHOR": {},
              "f:trigger.workflows.job/CHECKOUT_SHA": {},
              "f:workflows.argoproj.io/pod-name-format": {}
            },
            "f:generateName": {},
            "f:labels": {
              ".": {},
              "f:branch": {},
              "f:events.argoproj.io/action-timestamp": {},
              "f:events.argoproj.io/sensor": {},
              "f:events.argoproj.io/trigger": {},
              "f:project_id": {},
              "f:repository": {},
              "f:workflows.argoproj.io/creator": {},
              "f:workflows.argoproj.io/creator-preferred-username": {},
              "f:workflows.argoproj.io/resubmitted-from-workflow": {}
            }
          },
          "f:spec": {}
        }
      },
      {
        "manager": "workflow-controller",
        "operation": "Update",
        "apiVersion": "argoproj.io/v1alpha1",
        "time": "2026-01-20T14:33:41Z",
        "fieldsType": "FieldsV1",
        "fieldsV1": {
          "f:metadata": {
            "f:labels": {
              "f:workflows.argoproj.io/completed": {},
              "f:workflows.argoproj.io/phase": {}
            }
          },
          "f:status": {}
        }
      }
    ]
  },
  "spec": {
    "entrypoint": "main",
    "arguments": {
      "parameters": [
        {
          "name": "GIT_REPOSITORY_URL",
          "value": "https://gitlab.fawve.cluster.ws/fawve/finance.git"
        },
        {
          "name": "GIT_PUSH_REF",
          "value": "main"
        },
        {
          "name": "GIT_REPOSITORY_NAME",
          "value": "finance"
        },
        {
          "name": "GIT_CHECKOUT_SHA",
          "value": "b38758a4d38cd25468a9ab11c888a9b4bbc318b2"
        },
        {
          "name": "GIT_BEFORE_SHA",
          "value": "d67ea3643e87d813cbd8ff069a3d1e2710cacf57"
        },
        {
          "name": "CI_ENVIRONMENT_NAME",
          "value": "main"
        },
        {
          "name": "CI_REGISTRY_URL",
          "value": "https://registry.fawve.cluster.ws"
        },
        {
          "name": "CONTAINER_PLATFORM",
          "value": "linux/arm64"
        },
        {
          "name": "GIT_DEPLOY_REPOSITORY_URL",
          "value": "https://gitlab.fawve.cluster.ws/fawve/deploy.git"
        },
        {
          "name": "WORKFLOWS_API_DOMAIN",
          "value": "workflows.fawve.cluster.ws"
        },
        {
          "name": "WORKFLOWS_API_NAMESPACE",
          "value": "workflows"
        },
        {
          "name": "WORKFLOWS_API_PROJECT_ID",
          "value": "7"
        },
        {
          "name": "WORKFLOWS_API_REPOSITORY",
          "value": "finance"
        },
        {
          "name": "WORKFLOWS_API_BRANCH",
          "value": "main"
        },
        {
          "name": "TRIGGER_WORKFLOWS_JOB_AUTHOR",
          "value": "Eric"
        },
        {
          "name": "CI_DEBUG_TRACE",
          "value": "false"
        },
        {
          "name": "GIT_DEPLOY_BRANCH_NAME",
          "value": "main"
        },
        {
          "name": "NOTIFICATION_DINGTALK_BOT_ADDR",
          "value": "http://dingtalk-bot.argo-workflows.svc.cluster.local:8000"
        },
        {
          "name": "NOTIFICATION_CARD_TEMPLATE_ID",
          "value": "98a61096-31e1-4611-be4e-b1d2f6897225.schema"
        },
        {
          "name": "NOTIFICATION_OPEN_CONVERSATION_ID",
          "value": "cidUQXUpOwFEbiRNp87JyFE3w=="
        }
      ]
    },
    "podGC": {
      "strategy": "OnPodSuccess"
    },
    "shutdown": "Terminate",
    "workflowTemplateRef": {
      "name": "ci-java-jagat"
    }
  },
  "status": {
    "phase": "Failed",
    "startedAt": "2026-01-20T14:28:06Z",
    "finishedAt": "2026-01-20T14:33:40Z",
    "progress": "7/11",
    "message": "Stopped with strategy 'Terminate'",
    "nodes": {
      "cicd-java-main-finance-b38758a4-hhjbb": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb",
        "name": "cicd-java-main-finance-b38758a4-hhjbb",
        "displayName": "cicd-java-main-finance-b38758a4-hhjbb",
        "type": "DAG",
        "templateName": "main",
        "templateScope": "local/",
        "phase": "Failed",
        "startedAt": "2026-01-20T14:28:06Z",
        "finishedAt": "2026-01-20T14:33:17Z",
        "progress": "7/11",
        "resourcesDuration": {
          "cpu": 42,
          "memory": 475
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-2553748563",
          "cicd-java-main-finance-b38758a4-hhjbb-2131133452"
        ],
        "outboundNodes": [
          "cicd-java-main-finance-b38758a4-hhjbb-2775002877",
          "cicd-java-main-finance-b38758a4-hhjbb-247794171"
        ]
      },
      "cicd-java-main-finance-b38758a4-hhjbb-2131133452": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-2131133452",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.previous-commit-sha",
        "displayName": "previous-commit-sha",
        "type": "Pod",
        "templateName": "get-previous-successful-commit-sha",
        "templateScope": "local/",
        "phase": "Succeeded",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "startedAt": "2026-01-20T14:28:06Z",
        "finishedAt": "2026-01-20T14:28:21Z",
        "progress": "1/1",
        "resourcesDuration": {
          "cpu": 0,
          "memory": 10
        },
        "inputs": {
          "parameters": [
            {
              "name": "WORKFLOWS_API_DOMAIN",
              "value": "workflows.fawve.cluster.ws"
            },
            {
              "name": "WORKFLOWS_API_NAMESPACE",
              "value": "workflows"
            },
            {
              "name": "WORKFLOWS_API_PROJECT_ID",
              "value": "7"
            },
            {
              "name": "WORKFLOWS_API_REPOSITORY",
              "value": "finance"
            },
            {
              "name": "WORKFLOWS_API_BRANCH",
              "value": "main"
            },
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "/tmp/PREVIOUS_CHECKOUT_SHA"
            },
            {
              "name": "CURRENT_GIT_CHECKOUT_SHA",
              "value": "b38758a4d38cd25468a9ab11c888a9b4bbc318b2",
              "description": "本次任务的 Commit SHA 值，用于判断是否重复执行任务"
            }
          ]
        },
        "outputs": {
          "parameters": [
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "0000000000000000000000000000000000000000",
              "valueFrom": {
                "path": "/tmp/PREVIOUS_CHECKOUT_SHA"
              },
              "globalName": "PREVIOUS_CHECKOUT_SHA"
            }
          ],
          "artifacts": [
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-get-previous-successful-commit-sha-2131133452/main.log"
              }
            }
          ],
          "exitCode": "0"
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-258446681"
        ],
        "hostNodeName": "k8s03.local.ml"
      },
      "cicd-java-main-finance-b38758a4-hhjbb-2449782576": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-2449782576",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.docker-build(0:app:ml.fawve.springcloud:eureka-server:,appname:eureka-server,dir:eureka-server,jar_path:eureka-server/target/eureka-server-0.0.2-SNAPSHOT.jar)",
        "displayName": "docker-build(0:app:ml.fawve.springcloud:eureka-server:,appname:eureka-server,dir:eureka-server,jar_path:eureka-server/target/eureka-server-0.0.2-SNAPSHOT.jar)",
        "type": "Pod",
        "templateName": "container",
        "templateScope": "local/",
        "phase": "Failed",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "message": "workflow shutdown with strategy:  Terminate",
        "startedAt": "2026-01-20T14:32:53Z",
        "finishedAt": "2026-01-20T14:33:17Z",
        "progress": "0/1",
        "inputs": {
          "parameters": [
            {
              "name": "APPNAME",
              "value": "eureka-server"
            },
            {
              "name": "CONTEXT_ROOT",
              "value": "eureka-server"
            },
            {
              "name": "CI_REGISTRY_URL",
              "value": "https://registry.fawve.cluster.ws"
            },
            {
              "name": "REGISTRY_CREDENTIAL_SECRET_NAME",
              "value": "container-registry-credential"
            },
            {
              "name": "CI_COMMIT_SHORT_SHA",
              "value": "b38758a"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "dev"
            },
            {
              "name": "CONTAINER_PLATFORM",
              "value": "linux/amd64"
            },
            {
              "name": "PUSH_RETRY",
              "value": "5"
            }
          ]
        },
        "outputs": {
          "artifacts": [
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-container-2449782576/main.log"
              }
            }
          ],
          "result": "",
          "exitCode": "143"
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-247794171"
        ],
        "hostNodeName": "k8s03.local.ml"
      },
      "cicd-java-main-finance-b38758a4-hhjbb-247794171": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-247794171",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.sync-deploy",
        "displayName": "sync-deploy",
        "type": "Skipped",
        "templateName": "sync-deploy",
        "templateScope": "local/",
        "phase": "Omitted",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "message": "omitted: depends condition not met",
        "startedAt": "2026-01-20T14:33:17Z",
        "finishedAt": "2026-01-20T14:33:17Z",
        "nodeFlag": {}
      },
      "cicd-java-main-finance-b38758a4-hhjbb-2553748563": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-2553748563",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.clone",
        "displayName": "clone",
        "type": "Pod",
        "templateName": "clone",
        "templateScope": "local/",
        "phase": "Succeeded",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "startedAt": "2026-01-20T14:28:06Z",
        "finishedAt": "2026-01-20T14:28:22Z",
        "progress": "1/1",
        "resourcesDuration": {
          "cpu": 0,
          "memory": 13
        },
        "inputs": {
          "parameters": [
            {
              "name": "WORKFLOWS_API_DOMAIN",
              "value": "workflows.fawve.cluster.ws"
            },
            {
              "name": "WORKFLOWS_API_NAMESPACE",
              "value": "workflows"
            },
            {
              "name": "WORKFLOWS_API_PROJECT_ID",
              "value": "7"
            },
            {
              "name": "WORKFLOWS_API_REPOSITORY",
              "value": "finance"
            },
            {
              "name": "WORKFLOWS_API_BRANCH",
              "value": "main"
            },
            {
              "name": "GIT_REPOSITORY_URL",
              "value": "https://gitlab.fawve.cluster.ws/fawve/finance.git"
            },
            {
              "name": "GIT_PUSH_REF",
              "value": "main"
            },
            {
              "name": "TRIGGER_ACCOUNT",
              "value": "user-01"
            },
            {
              "name": "GIT_CHECKOUT_SHA",
              "value": "b38758a4d38cd25468a9ab11c888a9b4bbc318b2"
            },
            {
              "name": "GIT_REPOSITORY_NAME",
              "value": "finance"
            },
            {
              "name": "OBJECT_KIND",
              "value": "push"
            },
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "/tmp/git/PREVIOUS_CHECKOUT_SHA"
            }
          ]
        },
        "outputs": {
          "parameters": [
            {
              "name": "CI_COMMIT_SHORT_SHA",
              "value": "b38758a",
              "valueFrom": {
                "path": "/tmp/CI_COMMIT_SHORT_SHA"
              },
              "globalName": "CI_COMMIT_SHORT_SHA"
            },
            {
              "name": "CI_COMMIT_MESSAGE",
              "value": "feat: 触发打包\n",
              "valueFrom": {
                "path": "/tmp/CI_COMMIT_MESSAGE"
              },
              "globalName": "CI_COMMIT_MESSAGE"
            }
          ],
          "artifacts": [
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-clone-2553748563/main.log"
              }
            }
          ],
          "exitCode": "0"
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-258446681",
          "cicd-java-main-finance-b38758a4-hhjbb-4034592005",
          "cicd-java-main-finance-b38758a4-hhjbb-2775002877"
        ],
        "hostNodeName": "k8s03.local.ml"
      },
      "cicd-java-main-finance-b38758a4-hhjbb-2561201363": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-2561201363",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.docker-build(1:app:ml.fawve.springcloud:user:,appname:user,dir:user,jar_path:user/target/user-0.0.2-SNAPSHOT.jar)",
        "displayName": "docker-build(1:app:ml.fawve.springcloud:user:,appname:user,dir:user,jar_path:user/target/user-0.0.2-SNAPSHOT.jar)",
        "type": "Pod",
        "templateName": "container",
        "templateScope": "local/",
        "phase": "Failed",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "message": "workflow shutdown with strategy:  Terminate",
        "startedAt": "2026-01-20T14:32:54Z",
        "finishedAt": "2026-01-20T14:33:17Z",
        "progress": "0/1",
        "inputs": {
          "parameters": [
            {
              "name": "APPNAME",
              "value": "user"
            },
            {
              "name": "CONTEXT_ROOT",
              "value": "user"
            },
            {
              "name": "CI_REGISTRY_URL",
              "value": "https://registry.fawve.cluster.ws"
            },
            {
              "name": "REGISTRY_CREDENTIAL_SECRET_NAME",
              "value": "container-registry-credential"
            },
            {
              "name": "CI_COMMIT_SHORT_SHA",
              "value": "b38758a"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "dev"
            },
            {
              "name": "CONTAINER_PLATFORM",
              "value": "linux/amd64"
            },
            {
              "name": "PUSH_RETRY",
              "value": "5"
            }
          ]
        },
        "outputs": {
          "artifacts": [
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-container-2561201363/main.log"
              }
            }
          ],
          "result": "",
          "exitCode": "143"
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-247794171"
        ],
        "hostNodeName": "k8s03.local.ml"
      },
      "cicd-java-main-finance-b38758a4-hhjbb-258446681": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-258446681",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.change-log",
        "displayName": "change-log",
        "type": "Pod",
        "templateName": "change-log",
        "templateScope": "local/",
        "phase": "Succeeded",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "startedAt": "2026-01-20T14:28:27Z",
        "finishedAt": "2026-01-20T14:28:36Z",
        "progress": "1/1",
        "resourcesDuration": {
          "cpu": 0,
          "memory": 4
        },
        "inputs": {
          "parameters": [
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "0000000000000000000000000000000000000000",
              "description": "上一次成功执行任务的SHA,默认值0000000000000000000000000000000000000000"
            },
            {
              "name": "GIT_CHECKOUT_SHA",
              "value": "b38758a4d38cd25468a9ab11c888a9b4bbc318b2",
              "description": "本次触发任务的 SHA"
            },
            {
              "name": "GIT_PUSH_REF",
              "value": "main"
            }
          ]
        },
        "outputs": {
          "parameters": [
            {
              "name": "CHANGE_LOG",
              "value": "From: Last10..HEAD\n- dellnoantechnp (6):\n    84b99ce (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    aa95a87 (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    e37f4be (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    ebcb669 (6 months ago) feat: add liquibase-test model.\n    d9e032e (5 months ago) feat: add liquibase-test model.\n    d67ea36 (4 weeks ago) feat: update Dockerfile.dev\n\n- eric (4):\n    eb5992c (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    69d348c (6 months ago) feat: product 增加 druid 配置\n    f434a51 (4 weeks ago) feat: 增加 workflows cicd 的环境映射配置文件\n    b38758a (5 days ago) feat: 触发打包\n",
              "valueFrom": {
                "path": "/tmp/changelog.txt"
              },
              "globalName": "CHANGE_LOG",
              "description": "Git Change Log 内容"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "dev",
              "valueFrom": {
                "path": "/tmp/CI_ENVIRONMENT_NAME.txt"
              },
              "globalName": "CI_ENVIRONMENT_NAME",
              "description": "发布环境名称"
            }
          ],
          "artifacts": [
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-change-log-258446681/main.log"
              }
            }
          ],
          "exitCode": "0"
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-2775002877"
        ],
        "hostNodeName": "k8s03.local.ml"
      },
      "cicd-java-main-finance-b38758a4-hhjbb-2775002877": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-2775002877",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.notification",
        "displayName": "notification",
        "type": "Pod",
        "templateName": "notification",
        "templateScope": "local/",
        "phase": "Succeeded",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "startedAt": "2026-01-20T14:28:47Z",
        "finishedAt": "2026-01-20T14:29:03Z",
        "progress": "1/1",
        "resourcesDuration": {
          "cpu": 1,
          "memory": 19
        },
        "inputs": {
          "parameters": [
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "0000000000000000000000000000000000000000",
              "description": "上一次成功执行任务的SHA,默认值0000000000000000000000000000000000000000"
            },
            {
              "name": "GIT_CHECKOUT_SHA",
              "value": "b38758a4d38cd25468a9ab11c888a9b4bbc318b2",
              "description": "本次触发任务的 SHA"
            },
            {
              "name": "GIT_REPOSITORY_URL",
              "value": "https://gitlab.fawve.cluster.ws/fawve/finance.git"
            },
            {
              "name": "GIT_PUSH_REF",
              "value": "main"
            },
            {
              "name": "GIT_REPOSITORY_NAME",
              "value": "finance"
            },
            {
              "name": "TRIGGER_WORKFLOWS_JOB_AUTHOR",
              "value": "Eric"
            },
            {
              "name": "NOTIFICATION_DINGTALK_BOT_ADDR",
              "value": "http://dingtalk-bot.argo-workflows.svc.cluster.local:8000"
            },
            {
              "name": "PROJECT_ID",
              "value": "7",
              "description": "源码仓库项目的ID"
            },
            {
              "name": "NOTIFICATION_CARD_TEMPLATE_ID",
              "value": "98a61096-31e1-4611-be4e-b1d2f6897225.schema",
              "description": "互动卡片模板ID"
            },
            {
              "name": "NOTIFICATION_OPEN_CONVERSATION_ID",
              "value": "cidUQXUpOwFEbiRNp87JyFE3w==",
              "description": "互动卡片投递群聊ID"
            },
            {
              "name": "CHANGE_LOG",
              "value": "From: Last10..HEAD\n- dellnoantechnp (6):\n    84b99ce (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    aa95a87 (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    e37f4be (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    ebcb669 (6 months ago) feat: add liquibase-test model.\n    d9e032e (5 months ago) feat: add liquibase-test model.\n    d67ea36 (4 weeks ago) feat: update Dockerfile.dev\n\n- eric (4):\n    eb5992c (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    69d348c (6 months ago) feat: product 增加 druid 配置\n    f434a51 (4 weeks ago) feat: 增加 workflows cicd 的环境映射配置文件\n    b38758a (5 days ago) feat: 触发打包\n",
              "description": "Git Change Log"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "dev",
              "description": "发布环境名称"
            }
          ]
        },
        "outputs": {
          "artifacts": [
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-notification-2775002877/main.log"
              }
            }
          ],
          "exitCode": "0"
        },
        "hostNodeName": "k8s03.local.ml"
      },
      "cicd-java-main-finance-b38758a4-hhjbb-3342717902": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-3342717902",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.build",
        "displayName": "build",
        "type": "Pod",
        "templateName": "build",
        "templateScope": "local/",
        "phase": "Succeeded",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "startedAt": "2026-01-20T14:31:04Z",
        "finishedAt": "2026-01-20T14:32:23Z",
        "progress": "1/1",
        "resourcesDuration": {
          "cpu": 14,
          "memory": 145
        },
        "inputs": {
          "parameters": [
            {
              "name": "MAVEN_LOCAL_REPO_DIR",
              "value": "/workspace/repository"
            },
            {
              "name": "MAVEN_OPTS",
              "value": "-Dhttps.protocols=TLSv1.2 -Dmaven.repo.local=$(MAVEN_LOCAL_REPO_DIR) -Dorg.slf4j.simpleLogger.showDateTime=true -Djava.awt.headless=true"
            },
            {
              "name": "MAVEN_CLI_OPTS",
              "value": "--batch-mode --errors --fail-at-end --show-version --no-transfer-progress --threads=4 --settings /workspace/settings.xml -DinstallAtEnd=true -DdeployAtEnd=true -Dmaven.test.skip=true -P k8s"
            }
          ],
          "artifacts": [
            {
              "name": "dependencies-list",
              "path": "/workspace/BUILD.txt",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-preflight-4034592005/dependencies-list.tgz"
              }
            }
          ]
        },
        "outputs": {
          "artifacts": [
            {
              "name": "artifacts-list",
              "path": "/workspace/BUILD.txt",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-build-3342717902/artifacts-list.tgz"
              }
            },
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-build-3342717902/main.log"
              }
            }
          ],
          "exitCode": "0"
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-3369515995"
        ],
        "hostNodeName": "k8s03.local.ml"
      },
      "cicd-java-main-finance-b38758a4-hhjbb-3369515995": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-3369515995",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.result-to-json-list",
        "displayName": "result-to-json-list",
        "type": "Pod",
        "templateName": "result-to-json-list",
        "templateScope": "local/",
        "phase": "Succeeded",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "startedAt": "2026-01-20T14:32:33Z",
        "finishedAt": "2026-01-20T14:32:42Z",
        "progress": "1/1",
        "resourcesDuration": {
          "cpu": 0,
          "memory": 5
        },
        "inputs": {
          "artifacts": [
            {
              "name": "artifacts-list",
              "path": "/workspace/BUILD.txt",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-build-3342717902/artifacts-list.tgz"
              }
            }
          ]
        },
        "outputs": {
          "artifacts": [
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-result-to-json-list-3369515995/main.log"
              }
            }
          ],
          "result": "[\n  {\n    \"app\": \"ml.fawve.springcloud:eureka-server:\",\n    \"dir\": \"eureka-server\",\n    \"jar_path\": \"eureka-server/target/eureka-server-0.0.2-SNAPSHOT.jar\",\n    \"appname\": \"eureka-server\"\n  },\n  {\n    \"app\": \"ml.fawve.springcloud:user:\",\n    \"dir\": \"user\",\n    \"jar_path\": \"user/target/user-0.0.2-SNAPSHOT.jar\",\n    \"appname\": \"user\"\n  },\n  {\n    \"app\": \"ml.fawve.springcloud:fund:\",\n    \"dir\": \"fund\",\n    \"jar_path\": \"fund/target/fund-0.0.2-SNAPSHOT.jar\",\n    \"appname\": \"fund\"\n  },\n  {\n    \"app\": \"ml.fawve.springcloud:product:\",\n    \"dir\": \"product\",\n    \"jar_path\": \"product/target/product-0.0.2-SNAPSHOT.jar\",\n    \"appname\": \"product\"\n  }\n]",
          "exitCode": "0"
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-3955827291"
        ],
        "hostNodeName": "k8s03.local.ml"
      },
      "cicd-java-main-finance-b38758a4-hhjbb-359253584": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-359253584",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.docker-build(2:app:ml.fawve.springcloud:fund:,appname:fund,dir:fund,jar_path:fund/target/fund-0.0.2-SNAPSHOT.jar)",
        "displayName": "docker-build(2:app:ml.fawve.springcloud:fund:,appname:fund,dir:fund,jar_path:fund/target/fund-0.0.2-SNAPSHOT.jar)",
        "type": "Pod",
        "templateName": "container",
        "templateScope": "local/",
        "phase": "Failed",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "message": "Error (exit code 143)",
        "startedAt": "2026-01-20T14:32:54Z",
        "finishedAt": "2026-01-20T14:33:17Z",
        "progress": "0/1",
        "inputs": {
          "parameters": [
            {
              "name": "APPNAME",
              "value": "fund"
            },
            {
              "name": "CONTEXT_ROOT",
              "value": "fund"
            },
            {
              "name": "CI_REGISTRY_URL",
              "value": "https://registry.fawve.cluster.ws"
            },
            {
              "name": "REGISTRY_CREDENTIAL_SECRET_NAME",
              "value": "container-registry-credential"
            },
            {
              "name": "CI_COMMIT_SHORT_SHA",
              "value": "b38758a"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "dev"
            },
            {
              "name": "CONTAINER_PLATFORM",
              "value": "linux/amd64"
            },
            {
              "name": "PUSH_RETRY",
              "value": "5"
            }
          ]
        },
        "outputs": {
          "artifacts": [
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-container-359253584/main.log"
              }
            }
          ],
          "result": "",
          "exitCode": "143"
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-247794171"
        ],
        "hostNodeName": "k8s02.local.ml"
      },
      "cicd-java-main-finance-b38758a4-hhjbb-3883381747": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-3883381747",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.docker-build(3:app:ml.fawve.springcloud:product:,appname:product,dir:product,jar_path:product/target/product-0.0.2-SNAPSHOT.jar)",
        "displayName": "docker-build(3:app:ml.fawve.springcloud:product:,appname:product,dir:product,jar_path:product/target/product-0.0.2-SNAPSHOT.jar)",
        "type": "Pod",
        "templateName": "container",
        "templateScope": "local/",
        "phase": "Failed",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "message": "Error (exit code 143)",
        "startedAt": "2026-01-20T14:32:54Z",
        "finishedAt": "2026-01-20T14:33:17Z",
        "progress": "0/1",
        "inputs": {
          "parameters": [
            {
              "name": "APPNAME",
              "value": "product"
            },
            {
              "name": "CONTEXT_ROOT",
              "value": "product"
            },
            {
              "name": "CI_REGISTRY_URL",
              "value": "https://registry.fawve.cluster.ws"
            },
            {
              "name": "REGISTRY_CREDENTIAL_SECRET_NAME",
              "value": "container-registry-credential"
            },
            {
              "name": "CI_COMMIT_SHORT_SHA",
              "value": "b38758a"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "dev"
            },
            {
              "name": "CONTAINER_PLATFORM",
              "value": "linux/amd64"
            },
            {
              "name": "PUSH_RETRY",
              "value": "5"
            }
          ]
        },
        "outputs": {
          "artifacts": [
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-container-3883381747/main.log"
              }
            }
          ],
          "result": "",
          "exitCode": "143"
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-247794171"
        ],
        "hostNodeName": "k8s02.local.ml"
      },
      "cicd-java-main-finance-b38758a4-hhjbb-3955827291": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-3955827291",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.docker-build",
        "displayName": "docker-build",
        "type": "TaskGroup",
        "templateName": "container",
        "templateScope": "local/",
        "phase": "Failed",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "startedAt": "2026-01-20T14:32:53Z",
        "finishedAt": "2026-01-20T14:33:17Z",
        "progress": "0/4",
        "nodeFlag": {},
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-2449782576",
          "cicd-java-main-finance-b38758a4-hhjbb-2561201363",
          "cicd-java-main-finance-b38758a4-hhjbb-359253584",
          "cicd-java-main-finance-b38758a4-hhjbb-3883381747"
        ]
      },
      "cicd-java-main-finance-b38758a4-hhjbb-4034592005": {
        "id": "cicd-java-main-finance-b38758a4-hhjbb-4034592005",
        "name": "cicd-java-main-finance-b38758a4-hhjbb.preflight",
        "displayName": "preflight",
        "type": "Pod",
        "templateName": "preflight",
        "templateScope": "local/",
        "phase": "Succeeded",
        "boundaryID": "cicd-java-main-finance-b38758a4-hhjbb",
        "startedAt": "2026-01-20T14:28:27Z",
        "finishedAt": "2026-01-20T14:30:54Z",
        "progress": "1/1",
        "resourcesDuration": {
          "cpu": 27,
          "memory": 279
        },
        "inputs": {
          "parameters": [
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "0000000000000000000000000000000000000000",
              "description": "上一次成功执行任务的SHA,默认值0000000000000000000000000000000000000000"
            },
            {
              "name": "GIT_PUSH_REF",
              "value": "main"
            },
            {
              "name": "GIT_CHECKOUT_SHA",
              "value": "b38758a4d38cd25468a9ab11c888a9b4bbc318b2"
            },
            {
              "name": "GIT_BEFORE_SHA",
              "value": "d67ea3643e87d813cbd8ff069a3d1e2710cacf57"
            },
            {
              "name": "PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME",
              "value": ""
            },
            {
              "name": "MAVEN_LOCAL_REPO_DIR",
              "value": "/workspace/repository"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "main"
            },
            {
              "name": "MAVEN_OPTS",
              "value": "-Dhttps.protocols=TLSv1.2 -Dmaven.repo.local=$(MAVEN_LOCAL_REPO_DIR) -Dorg.slf4j.simpleLogger.showDateTime=false -Djava.awt.headless=true"
            },
            {
              "name": "MAVEN_CLI_OPTS",
              "value": "--batch-mode --no-transfer-progress --threads=1 --settings /workspace/settings.xml -Dmaven.test.skip=true -P k8s --fail-at-end -X"
            },
            {
              "name": "_MANUAL_",
              "value": "false"
            }
          ]
        },
        "outputs": {
          "parameters": [
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "dev",
              "valueFrom": {
                "path": "/tmp/CI_ENVIRONMENT_NAME"
              },
              "globalName": "CI_ENVIRONMENT_NAME"
            }
          ],
          "artifacts": [
            {
              "name": "dependencies-list",
              "path": "/workspace/BUILD.txt",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-preflight-4034592005/dependencies-list.tgz"
              }
            },
            {
              "name": "main-logs",
              "s3": {
                "key": "cicd-java-main-finance-b38758a4-hhjbb/cicd-java-main-finance-b38758a4-hhjbb-preflight-4034592005/main.log"
              }
            }
          ],
          "exitCode": "0"
        },
        "children": [
          "cicd-java-main-finance-b38758a4-hhjbb-3342717902"
        ],
        "hostNodeName": "k8s03.local.ml"
      }
    },
    "storedTemplates": {
      "namespaced/ci-java-jagat/build": {
        "name": "build",
        "inputs": {
          "parameters": [
            {
              "name": "MAVEN_LOCAL_REPO_DIR",
              "value": "/workspace/repository"
            },
            {
              "name": "MAVEN_OPTS",
              "value": "-Dhttps.protocols=TLSv1.2 -Dmaven.repo.local=$(MAVEN_LOCAL_REPO_DIR) -Dorg.slf4j.simpleLogger.showDateTime=true -Djava.awt.headless=true"
            },
            {
              "name": "MAVEN_CLI_OPTS",
              "value": "--batch-mode --errors --fail-at-end --show-version --no-transfer-progress --threads=4 --settings /workspace/settings.xml -DinstallAtEnd=true -DdeployAtEnd=true -Dmaven.test.skip=true -P k8s"
            }
          ],
          "artifacts": [
            {
              "name": "dependencies-list",
              "path": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
            }
          ]
        },
        "outputs": {
          "artifacts": [
            {
              "name": "artifacts-list",
              "path": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
            }
          ]
        },
        "metadata": {},
        "script": {
          "name": "maven-build",
          "image": "fcr.fawve.cluster.ws/maven:3.9-eclipse-tumurin-17",
          "command": [
            "bash",
            "-e"
          ],
          "workingDir": "/workspace",
          "env": [
            {
              "name": "_MANUAL_",
              "value": "{{workflow.parameters._MANUAL_}}"
            },
            {
              "name": "MAVEN_LOCAL_REPO_DIR",
              "value": "{{inputs.parameters.MAVEN_LOCAL_REPO_DIR}}"
            },
            {
              "name": "MAVEN_BUILD_PROJECT_DIR_FILE",
              "value": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
            },
            {
              "name": "MAVEN_OPTS",
              "value": "{{inputs.parameters.MAVEN_OPTS}}"
            },
            {
              "name": "MAVEN_CLI_OPTS",
              "value": "{{inputs.parameters.MAVEN_CLI_OPTS}}"
            },
            {
              "name": "CI_DEBUG_TRACE",
              "value": "{{workflow.parameters.CI_DEBUG_TRACE}}"
            }
          ],
          "resources": {},
          "volumeMounts": [
            {
              "name": "workspace",
              "mountPath": "/workspace"
            },
            {
              "name": "maven-settings",
              "mountPath": "/workspace/settings.xml",
              "subPath": "settings.xml"
            },
            {
              "name": "maven-repository-cache",
              "mountPath": "/workspace/repository"
            }
          ],
          "source": "# Debug Mode\nif [[ ${CI_DEBUG_TRACE} == true ]]; then set -x; fi\n\n# 适配多版本 jdk 编译需求\nJDK_VERSION_MAJOR=$(java --version &> /dev/stdout | grep -Po '(?<=openjdk ).*?(?=\\.)')\nMAVEN_LOCAL_REPO_DIR=${MAVEN_LOCAL_REPO_DIR}/repository-${JDK_VERSION_MAJOR}\necho \"INFO: Maven local repository dir -> ${MAVEN_LOCAL_REPO_DIR}\"\n\necho \"↓↓↓↓↓↓↓↓↓↓↓↓↓↓  maven:开始编译jar包 ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓\"\necho \">_ mvn ${MAVEN_CLI_OPTS} clean package -U -pl $(cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | awk '{print $2}' | tr \"\\n\" \",\") -am\"\nmvn ${MAVEN_CLI_OPTS} clean package -U -pl $(cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | awk '{print $2}' | tr \"\\n\" \",\") -am\necho \"↑↑↑↑↑↑↑↑↑↑↑↑  maven:编译完成  ↑↑↑↑↑↑↑↑↑↑↑↑↑↑\"\n\necho \"INFO: 查找需要进入流水线打包的物料...\"\nLINE_COUNT=$(cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | wc -l)\nif [[ -s ${MAVEN_BUILD_PROJECT_DIR_FILE} ]]; then\n  for line in $(cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | awk '{print $2}'); do\n    find . -path \"./.m2\" -prune -o -path \"${line%/}/target/*.jar\" -print\n  done\nfi\necho \"INFO: 查找物料结束.\"\n\nwhile read -r line; do\n  module_path=$(echo $line | awk '{print $2}')\n\n  jar_path=$(find $module_path -path \"*/target/*\" -name \"*.jar\")\n  line_number=$(grep -n \"${module_path}\" ${MAVEN_BUILD_PROJECT_DIR_FILE} | awk -F: '{print $1}')\n  ## 字段： maven模块名称     模块在project的相对路径    jar包文件在project的相对路径\n  sed -i \"${line_number}s&$&\\ ${jar_path}&\" ${MAVEN_BUILD_PROJECT_DIR_FILE}\n\n  ## 在字段中最后一个字段添加app_name名称 (命名规则:只能包含小写字母、数字，以及 '-' 和 '.')\n  if [[ -f ${module_path%/}/.appname ]]; then\n    # 取首行为模块名称，转换为小写字符\n    appname=$(head -1 ${module_path%/}/.appname | tr '[:upper:]' '[:lower:]')\n    echo \"INFO: 检测到模块路径 [${module_path%/}/.appname] 中存在模块名定义   appname -> ${appname#*/}\"\n  else\n    # 取项目目录的名称作为模块名\n    appname=$(echo ${module_path%/} | tr '[:upper:]' '[:lower:]')\n    echo \"INFO: 未指定模块名称，使用 [./${module_path%/}] 作为模块名      appname -> ${appname#*/}\"\n  fi\n  sed -i \"${line_number}s&$&\\ ${appname#*/}&\" ${MAVEN_BUILD_PROJECT_DIR_FILE}\ndone < ${MAVEN_BUILD_PROJECT_DIR_FILE}\ncat ${MAVEN_BUILD_PROJECT_DIR_FILE}\n\n#for module in $(cat ${MAVEN_BUILD_PROJECT_DIR_FILE}); do\n#  ## 构造 grep -e 命令行参数\n#  NEED_RECEIVE_JAR=\"${NEED_RECEIVE_JAR} -e $module\"\n#done\n#for file in $(find . -path \"*/target/*\" -name \"*.jar\"); do\n#    CODE=$(echo $file | grep -c ${NEED_RECEIVE_JAR}) || true\n#    if [[ $CODE -eq 0 ]]; then   ## 如果不需要保留制品\n#      echo \"INFO: 清理无用的依赖包 $file ...\" && rm -rf $file\n#    else\n#      continue\n#    fi\n#done\n#echo \"INFO: 清理任务完成，输出需要进入流水线的制品物料包\"\n#find . -path \"./.m2\" -prune -o -path \"*/target/*.jar\" -print); do\n"
        }
      },
      "namespaced/ci-java-jagat/change-log": {
        "name": "change-log",
        "inputs": {
          "parameters": [
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "0000000000000000000000000000000000000000",
              "description": "上一次成功执行任务的SHA,默认值0000000000000000000000000000000000000000"
            },
            {
              "name": "GIT_CHECKOUT_SHA",
              "description": "本次触发任务的 SHA"
            },
            {
              "name": "GIT_PUSH_REF"
            }
          ]
        },
        "outputs": {
          "parameters": [
            {
              "name": "CHANGE_LOG",
              "valueFrom": {
                "path": "/tmp/changelog.txt"
              },
              "globalName": "CHANGE_LOG",
              "description": "Git Change Log 内容"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "valueFrom": {
                "path": "/tmp/CI_ENVIRONMENT_NAME.txt"
              },
              "globalName": "CI_ENVIRONMENT_NAME",
              "description": "发布环境名称"
            }
          ]
        },
        "metadata": {},
        "container": {
          "name": "commit-logs",
          "image": "fcr.fawve.cluster.ws/bitnami/git@sha256:c01f7167dcd8d680a5bef264cc8213e1648e247ec739d6b15ee98ef5a1b0a467",
          "command": [
            "bash",
            "-ec"
          ],
          "args": [
            "set -x\n## 开始处理分支与环境的对应关系\n## eg:\n##  >_ cat ${project-root:-.}/environment-mapping.txt\n##  # branch   environment\n##  master     beta\n##  production prod\nif [[ -f environment-mapping.txt ]]; then\n  echo \"INFO: 检测到 environment-mapping.txt 项目环境配置文件\"\n  CI_ENVIRONMENT_NAME=$(awk \"/^${GIT_PUSH_REF#refs/heads/}/{print \\$2}\" environment-mapping.txt)\nelse\n  echo \"INFO: 未检测到 environment-mapping.txt 项目环境配置文件，环境名称将默认采用 branch 名称.\"\n  CI_ENVIRONMENT_NAME=${GIT_PUSH_REF#refs/heads/}\nfi\necho \"${CI_ENVIRONMENT_NAME}\" > /tmp/CI_ENVIRONMENT_NAME.txt\n\nfunction get_change_log(){\n  if [[ \"${PREVIOUS_CHECKOUT_SHA}\" != \"0000000000000000000000000000000000000000\" ]]; then\n    echo \"From: ${PREVIOUS_CHECKOUT_SHA:0:8}..HEAD\"\n    git shortlog ${PREVIOUS_CHECKOUT_SHA}..HEAD --pretty=format:\"%h %s\" --no-merges --group=format:'- %an' -w76,4 | uniq\n  else\n    echo \"From: Last10..HEAD\"\n    git shortlog -10 HEAD --pretty=format:\"%h (%cr) %s\" --no-merges --group=format:'- %an' -w98,4 | uniq\n  fi\n}\nget_change_log | tee -a '/tmp/changelog.txt'\n"
          ],
          "workingDir": "/workspace",
          "env": [
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "{{inputs.parameters.PREVIOUS_CHECKOUT_SHA}}"
            },
            {
              "name": "GIT_CHECKOUT_SHA",
              "value": "{{inputs.parameters.GIT_CHECKOUT_SHA}}"
            },
            {
              "name": "GIT_PUSH_REF",
              "value": "{{inputs.parameters.GIT_PUSH_REF}}"
            }
          ],
          "resources": {},
          "volumeMounts": [
            {
              "name": "workspace",
              "mountPath": "/workspace"
            }
          ]
        }
      },
      "namespaced/ci-java-jagat/clone": {
        "name": "clone",
        "inputs": {
          "parameters": [
            {
              "name": "WORKFLOWS_API_DOMAIN"
            },
            {
              "name": "WORKFLOWS_API_NAMESPACE"
            },
            {
              "name": "WORKFLOWS_API_PROJECT_ID"
            },
            {
              "name": "WORKFLOWS_API_REPOSITORY"
            },
            {
              "name": "WORKFLOWS_API_BRANCH"
            },
            {
              "name": "GIT_REPOSITORY_URL"
            },
            {
              "name": "GIT_PUSH_REF",
              "value": "main"
            },
            {
              "name": "TRIGGER_ACCOUNT",
              "value": "user-01"
            },
            {
              "name": "GIT_CHECKOUT_SHA"
            },
            {
              "name": "GIT_REPOSITORY_NAME"
            },
            {
              "name": "OBJECT_KIND",
              "value": "push"
            },
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "/tmp/git/PREVIOUS_CHECKOUT_SHA"
            }
          ]
        },
        "outputs": {
          "parameters": [
            {
              "name": "CI_COMMIT_SHORT_SHA",
              "valueFrom": {
                "path": "/tmp/CI_COMMIT_SHORT_SHA"
              },
              "globalName": "CI_COMMIT_SHORT_SHA"
            },
            {
              "name": "CI_COMMIT_MESSAGE",
              "valueFrom": {
                "path": "/tmp/CI_COMMIT_MESSAGE"
              },
              "globalName": "CI_COMMIT_MESSAGE"
            }
          ]
        },
        "metadata": {},
        "container": {
          "name": "git",
          "image": "fcr.fawve.cluster.ws/bitnami/git@sha256:c01f7167dcd8d680a5bef264cc8213e1648e247ec739d6b15ee98ef5a1b0a467",
          "command": [
            "bash",
            "-euc"
          ],
          "args": [
            "## Login settings\ncase \"${GIT_CREDENTIAL_TYPE}\" in\n  SSH|ssh)\n    echo \"INFO: git clone method by [SSH]\"\n    (umask 077 ; echo \"${GIT_SSH_PRIVATEKEY}\" > /git_key)\n    git config --global core.sshCommand 'ssh -i /git_key -o StrictHostKeyChecking=false'\n  ;;\n  *)\n    # https://git-scm.com/docs/gitcredentials store password\n    echo \"INFO: git clone method by [HTTPS]\"\n    git config --global credential.\"{{inputs.parameters.GIT_REPOSITORY_URL}}\".username \"${GIT_USER}\"\n    git config --global credential.\"{{inputs.parameters.GIT_REPOSITORY_URL}}\".helper '!p(){ echo \"password=\"${GIT_PASSWORD}\"\";}; p'\n  ;;\nesac\necho \">_ git clone --branch ${GIT_PUSH_REF#refs/heads/} ${GIT_REPOSITORY_URL} --single-branch .\"\nrm -rf * && git clone --branch \"${GIT_PUSH_REF#refs/heads/}\" \"${GIT_REPOSITORY_URL}\" --single-branch .\ngit reset --hard {{inputs.parameters.GIT_CHECKOUT_SHA}}\n\n# get some parameters\ngit rev-parse --short HEAD > /tmp/CI_COMMIT_SHORT_SHA     # 当前分支短Commit_SHA\ngit log -1 --pretty=%B > /tmp/CI_COMMIT_MESSAGE           # 当前提交的 log message\n"
          ],
          "workingDir": "/workspace",
          "env": [
            {
              "name": "GIT_REPOSITORY_URL",
              "value": "{{inputs.parameters.GIT_REPOSITORY_URL}}"
            },
            {
              "name": "GIT_PUSH_REF",
              "value": "{{inputs.parameters.GIT_PUSH_REF}}"
            },
            {
              "name": "GIT_USER",
              "valueFrom": {
                "secretKeyRef": {
                  "name": "git-repository-credential",
                  "key": "GIT_USER"
                }
              }
            },
            {
              "name": "GIT_PASSWORD",
              "valueFrom": {
                "secretKeyRef": {
                  "name": "git-repository-credential",
                  "key": "GIT_PASSWORD"
                }
              }
            },
            {
              "name": "GIT_CREDENTIAL_TYPE",
              "valueFrom": {
                "secretKeyRef": {
                  "name": "git-repository-credential",
                  "key": "GIT_CREDENTIAL_TYPE"
                }
              }
            },
            {
              "name": "GIT_SSH_PRIVATEKEY",
              "valueFrom": {
                "secretKeyRef": {
                  "name": "git-repository-credential",
                  "key": "GIT_SSH_PRIVATEKEY",
                  "optional": true
                }
              }
            }
          ],
          "resources": {},
          "volumeMounts": [
            {
              "name": "workspace",
              "mountPath": "/workspace"
            }
          ]
        }
      },
      "namespaced/ci-java-jagat/container": {
        "name": "container",
        "inputs": {
          "parameters": [
            {
              "name": "APPNAME"
            },
            {
              "name": "CONTEXT_ROOT"
            },
            {
              "name": "CI_REGISTRY_URL"
            },
            {
              "name": "REGISTRY_CREDENTIAL_SECRET_NAME"
            },
            {
              "name": "CI_COMMIT_SHORT_SHA"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "{{workflow.outputs.parameters.CI_ENVIRONMENT_NAME}}"
            },
            {
              "name": "CONTAINER_PLATFORM"
            },
            {
              "name": "PUSH_RETRY",
              "value": "5"
            }
          ]
        },
        "outputs": {},
        "metadata": {},
        "container": {
          "name": "podman",
          "image": "quay.io/podman/stable:v5",
          "command": [
            "bash",
            "-ec"
          ],
          "args": [
            "## 这个任务的 stdout 必须为一个有效 JSON 序列，所以需要将其他 stdout 全部重定向至 stderr \nREPO_NAME=${CI_REGISTRY_URL%/}/${APPNAME}\nTAG_NAME=${CI_ENVIRONMENT_NAME}-${CI_COMMIT_SHORT_SHA}\nIMAGE_NAME=\"${REPO_NAME}:${TAG_NAME}\"\nIMAGE_NAME=$(echo ${IMAGE_NAME} | tr '[:upper:]' '[:lower:]')     # 合规小写字符 lowercase\nIMAGE_NAME=${IMAGE_NAME#*//}                                      # truncate  http://  https:// \necho -e \"\\x1b[36mINFO\\x1b[0m: 开始使用 ${CONTEXT_ROOT}/Dockerfile.${CI_ENVIRONMENT_NAME} build images ${IMAGE_NAME} \\x1b[90m...\\x1b[0m\" > /dev/stderr 2>&1\npodman build --tag \"${IMAGE_NAME}\" --platform \"${CONTAINER_PLATFORM}\" --iidfile iid.txt --file  Dockerfile.${CI_ENVIRONMENT_NAME} \"${CONTEXT_ROOT}\" > /dev/stderr 2>&1 && \\\npodman push \"${IMAGE_NAME}\" --digestfile pushdigest.txt > /dev/stderr 2>&1 && \\\nIMAGE_NAME_DIGEST=\"${IMAGE_NAME}@$(cat pushdigest.txt)\" \\\n#/kaniko/executor --context \"${CONTEXT_ROOT}\" --dockerfile Dockerfile.${CI_ENVIRONMENT_NAME} \\\n#  --image-download-retry 3 \\\n#  --push-retry 3 \\\n#  --destination \"${IMAGE_NAME}\"  \\\n#  --reproducible \\\n#  --cache=true \\\n#  --cache-ttl=72h \\\n#  --cache-repo=${IMAGE_NAME%%/*}/kaniko_caches \\\n#  --push-retry=\"${PUSH_RETRY}\" \\\n#  --custom-platform=\"${CONTAINER_PLATFORM}\"\n\nif [[ $(podman images -n ${IMAGE_NAME} | wc -l) -ge 1 ]]; then\n  echo \"INFO: Image build & push complete.\" > /dev/stderr 2>&1\n  podman images ${IMAGE_NAME} > /dev/stderr 2>&1\n  cat <<EOF\n{\n  \"APPNAME\": \"${APPNAME}\",\n  \"CONTEXT_ROOT\": \"${CONTEXT_ROOT}\",\n  \"CI_ENVIRONMENT_NAME\": \"${CI_ENVIRONMENT_NAME}\",\n  \"IMAGE_NAME\": \"${IMAGE_NAME}\",\n  \"IMAGE_NAME_DIGEST\": \"${IMAGE_NAME_DIGEST}\",\n  \"CI_COMMIT_SHORT_SHA\": \"${CI_COMMIT_SHORT_SHA}\",\n  \"Container_platform\": \"${CONTAINER_PLATFORM}\"\n}\nEOF\nelse\n  echo \"ERROR: Image build failed.\"\n  false\nfi\n"
          ],
          "workingDir": "/workspace",
          "env": [
            {
              "name": "APPNAME",
              "value": "{{inputs.parameters.APPNAME}}"
            },
            {
              "name": "CONTEXT_ROOT",
              "value": "{{inputs.parameters.CONTEXT_ROOT}}"
            },
            {
              "name": "CI_REGISTRY_URL",
              "value": "{{inputs.parameters.CI_REGISTRY_URL}}"
            },
            {
              "name": "CI_COMMIT_SHORT_SHA",
              "value": "{{inputs.parameters.CI_COMMIT_SHORT_SHA}}"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "{{inputs.parameters.CI_ENVIRONMENT_NAME}}"
            },
            {
              "name": "CONTAINER_PLATFORM",
              "value": "{{inputs.parameters.CONTAINER_PLATFORM}}"
            },
            {
              "name": "PUSH_RETRY",
              "value": "{{inputs.parameters.PUSH_RETRY}}"
            },
            {
              "name": "REGISTRY_USER",
              "valueFrom": {
                "secretKeyRef": {
                  "name": "{{inputs.parameters.REGISTRY_CREDENTIAL_SECRET_NAME}}",
                  "key": "REGISTRY_USER"
                }
              }
            },
            {
              "name": "REGISTRY_PASSWORD",
              "valueFrom": {
                "secretKeyRef": {
                  "name": "{{inputs.parameters.REGISTRY_CREDENTIAL_SECRET_NAME}}",
                  "key": "REGISTRY_PASSWORD"
                }
              }
            }
          ],
          "resources": {
            "limits": {
              "cpu": "4",
              "memory": "1500Mi"
            },
            "requests": {
              "cpu": "500m",
              "memory": "800Mi"
            }
          },
          "volumeMounts": [
            {
              "name": "workspace",
              "mountPath": "/workspace"
            },
            {
              "name": "config-json",
              "mountPath": "/run/containers/0/"
            }
          ],
          "securityContext": {
            "privileged": true
          }
        },
        "volumes": [
          {
            "name": "config-json",
            "emptyDir": {}
          }
        ],
        "initContainers": [
          {
            "name": "registry-login",
            "image": "docker:cli",
            "command": [
              "sh",
              "-ec"
            ],
            "args": [
              "docker login --username ${REGISTRY_USER} --password ${REGISTRY_PASSWORD} {{inputs.parameters.CI_REGISTRY_URL}}\ncp /root/.docker/config.json /run/containers/0/auth.json\n"
            ],
            "env": [
              {
                "name": "REGISTRY_USER",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "{{inputs.parameters.REGISTRY_CREDENTIAL_SECRET_NAME}}",
                    "key": "REGISTRY_USER"
                  }
                }
              },
              {
                "name": "REGISTRY_PASSWORD",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "{{inputs.parameters.REGISTRY_CREDENTIAL_SECRET_NAME}}",
                    "key": "REGISTRY_PASSWORD"
                  }
                }
              }
            ],
            "resources": {},
            "volumeMounts": [
              {
                "name": "config-json",
                "mountPath": "/run/containers/0/"
              }
            ]
          }
        ]
      },
      "namespaced/ci-java-jagat/get-previous-successful-commit-sha": {
        "name": "get-previous-successful-commit-sha",
        "inputs": {
          "parameters": [
            {
              "name": "WORKFLOWS_API_DOMAIN"
            },
            {
              "name": "WORKFLOWS_API_NAMESPACE"
            },
            {
              "name": "WORKFLOWS_API_PROJECT_ID"
            },
            {
              "name": "WORKFLOWS_API_REPOSITORY"
            },
            {
              "name": "WORKFLOWS_API_BRANCH"
            },
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "/tmp/PREVIOUS_CHECKOUT_SHA"
            },
            {
              "name": "CURRENT_GIT_CHECKOUT_SHA",
              "description": "本次任务的 Commit SHA 值，用于判断是否重复执行任务"
            }
          ]
        },
        "outputs": {
          "parameters": [
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "valueFrom": {
                "path": "/tmp/PREVIOUS_CHECKOUT_SHA"
              },
              "globalName": "PREVIOUS_CHECKOUT_SHA"
            }
          ]
        },
        "metadata": {},
        "container": {
          "name": "workflow-previous-commit-sha",
          "image": "dellnoantechnp/git-yq:2.44",
          "command": [
            "bash",
            "-c"
          ],
          "args": [
            "echo \"INFO: Starting get last previous checkout sha by API [{{inputs.parameters.WORKFLOWS_API_DOMAIN}}] ....\"\ncurl -s --location \"https://{{inputs.parameters.WORKFLOWS_API_DOMAIN}}/api/v1/workflows/{{inputs.parameters.WORKFLOWS_API_NAMESPACE}}?\\\nlistOptions.labelSelector=\\\nproject_id={{inputs.parameters.WORKFLOWS_API_PROJECT_ID}},\\\nrepository={{inputs.parameters.WORKFLOWS_API_REPOSITORY}},\\\nbranch={{inputs.parameters.WORKFLOWS_API_BRANCH}}&\\\nfields=items.metadata.annotations,items.status.phase\" \\\n--header \"Authorization: Bearer $(cat /var/run/kubernetes/argo-workflows-token)\" | \\\njq -r 'limit(1; .items[] | select(.status.phase==\"Succeeded\") | select(.metadata.annotations.\"trigger.workflows.job/CHECKOUT_SHA\"!=\"{{inputs.parameters.CURRENT_GIT_CHECKOUT_SHA}}\")) | .metadata.annotations.\"'${ANNOTATION_CHECKOUT_SHA_NAME}'\"' | \\\ntee {{inputs.parameters.PREVIOUS_CHECKOUT_SHA}}\n\nif [[ -s {{inputs.parameters.PREVIOUS_CHECKOUT_SHA}} ]]; then\n  echo -e \"\\x1b[32mINFO\\x1b[0m: Finished to get last previous checkout sha by API.\"\nelse\n  echo \"0000000000000000000000000000000000000000\" > {{inputs.parameters.PREVIOUS_CHECKOUT_SHA}}\n  echo -e \"\\x1b[31mERROR\\x1b[0m: Failed to get last previous checkout sha by API, Set previous sha 0000000000000000000000000000000000000000\"\nfi\n"
          ],
          "workingDir": "/workspace",
          "env": [
            {
              "name": "ANNOTATION_CHECKOUT_SHA_NAME",
              "value": "trigger.workflows.job/CHECKOUT_SHA"
            }
          ],
          "resources": {},
          "volumeMounts": [
            {
              "name": "argo-workflows-operator-token",
              "mountPath": "/var/run/kubernetes/argo-workflows-token",
              "subPath": "token"
            }
          ]
        },
        "metrics": {
          "prometheus": [
            {
              "name": "ci_result_task_counter",
              "labels": [
                {
                  "key": "stage",
                  "value": "clone"
                },
                {
                  "key": "branch",
                  "value": "{{ workflow.parameters.GIT_PUSH_REF }}"
                },
                {
                  "key": "status",
                  "value": "{{ status }}"
                }
              ],
              "help": "Count of task execution by result status - task level",
              "counter": {
                "value": "1"
              }
            }
          ]
        }
      },
      "namespaced/ci-java-jagat/main": {
        "name": "main",
        "inputs": {},
        "outputs": {},
        "metadata": {},
        "dag": {
          "tasks": [
            {
              "name": "clone",
              "template": "clone",
              "arguments": {
                "parameters": [
                  {
                    "name": "WORKFLOWS_API_DOMAIN",
                    "value": "{{workflow.parameters.WORKFLOWS_API_DOMAIN}}"
                  },
                  {
                    "name": "WORKFLOWS_API_NAMESPACE",
                    "value": "{{workflow.parameters.WORKFLOWS_API_NAMESPACE}}"
                  },
                  {
                    "name": "WORKFLOWS_API_PROJECT_ID",
                    "value": "{{workflow.parameters.WORKFLOWS_API_PROJECT_ID}}"
                  },
                  {
                    "name": "WORKFLOWS_API_REPOSITORY",
                    "value": "{{workflow.parameters.WORKFLOWS_API_REPOSITORY}}"
                  },
                  {
                    "name": "WORKFLOWS_API_BRANCH",
                    "value": "{{workflow.parameters.WORKFLOWS_API_BRANCH}}"
                  },
                  {
                    "name": "GIT_REPOSITORY_URL",
                    "value": "{{workflow.parameters.GIT_REPOSITORY_URL}}"
                  },
                  {
                    "name": "GIT_PUSH_REF",
                    "value": "{{workflow.parameters.GIT_PUSH_REF}}"
                  },
                  {
                    "name": "GIT_CHECKOUT_SHA",
                    "value": "{{workflow.parameters.GIT_CHECKOUT_SHA}}"
                  },
                  {
                    "name": "GIT_REPOSITORY_NAME",
                    "value": "{{workflow.parameters.GIT_REPOSITORY_NAME}}"
                  }
                ]
              }
            },
            {
              "name": "previous-commit-sha",
              "template": "get-previous-successful-commit-sha",
              "arguments": {
                "parameters": [
                  {
                    "name": "WORKFLOWS_API_DOMAIN",
                    "value": "{{workflow.parameters.WORKFLOWS_API_DOMAIN}}"
                  },
                  {
                    "name": "WORKFLOWS_API_NAMESPACE",
                    "value": "{{workflow.parameters.WORKFLOWS_API_NAMESPACE}}"
                  },
                  {
                    "name": "WORKFLOWS_API_PROJECT_ID",
                    "value": "{{workflow.parameters.WORKFLOWS_API_PROJECT_ID}}"
                  },
                  {
                    "name": "WORKFLOWS_API_REPOSITORY",
                    "value": "{{workflow.parameters.WORKFLOWS_API_REPOSITORY}}"
                  },
                  {
                    "name": "WORKFLOWS_API_BRANCH",
                    "value": "{{workflow.parameters.WORKFLOWS_API_BRANCH}}"
                  },
                  {
                    "name": "CURRENT_GIT_CHECKOUT_SHA",
                    "value": "{{workflow.parameters.GIT_CHECKOUT_SHA}}",
                    "description": "本次CI的commit SHA值"
                  }
                ]
              }
            },
            {
              "name": "change-log",
              "template": "change-log",
              "arguments": {
                "parameters": [
                  {
                    "name": "PREVIOUS_CHECKOUT_SHA",
                    "value": "{{workflow.outputs.parameters.PREVIOUS_CHECKOUT_SHA}}"
                  },
                  {
                    "name": "GIT_CHECKOUT_SHA",
                    "value": "{{workflow.parameters.GIT_CHECKOUT_SHA}}"
                  },
                  {
                    "name": "GIT_PUSH_REF",
                    "value": "{{workflow.parameters.GIT_PUSH_REF}}"
                  }
                ]
              },
              "depends": "clone.Succeeded && previous-commit-sha.Succeeded"
            },
            {
              "name": "notification",
              "template": "notification",
              "arguments": {
                "parameters": [
                  {
                    "name": "PREVIOUS_CHECKOUT_SHA",
                    "value": "{{workflow.outputs.parameters.PREVIOUS_CHECKOUT_SHA}}"
                  },
                  {
                    "name": "GIT_REPOSITORY_URL",
                    "value": "{{workflow.parameters.GIT_REPOSITORY_URL}}"
                  },
                  {
                    "name": "GIT_PUSH_REF",
                    "value": "{{workflow.parameters.GIT_PUSH_REF}}"
                  },
                  {
                    "name": "GIT_REPOSITORY_NAME",
                    "value": "{{workflow.parameters.GIT_REPOSITORY_NAME}}"
                  },
                  {
                    "name": "TRIGGER_WORKFLOWS_JOB_AUTHOR",
                    "value": "{{workflow.parameters.TRIGGER_WORKFLOWS_JOB_AUTHOR}}"
                  },
                  {
                    "name": "GIT_CHECKOUT_SHA",
                    "value": "{{workflow.parameters.GIT_CHECKOUT_SHA}}"
                  },
                  {
                    "name": "PROJECT_ID",
                    "value": "{{workflow.parameters.WORKFLOWS_API_PROJECT_ID}}"
                  },
                  {
                    "name": "NOTIFICATION_CARD_TEMPLATE_ID",
                    "value": "{{workflow.parameters.NOTIFICATION_CARD_TEMPLATE_ID}}"
                  },
                  {
                    "name": "NOTIFICATION_OPEN_CONVERSATION_ID",
                    "value": "{{workflow.parameters.NOTIFICATION_OPEN_CONVERSATION_ID}}"
                  },
                  {
                    "name": "NOTIFICATION_DINGTALK_BOT_ADDR",
                    "value": "{{workflow.parameters.NOTIFICATION_DINGTALK_BOT_ADDR}}"
                  },
                  {
                    "name": "CHANGE_LOG",
                    "value": "{{tasks.change-log.outputs.parameters.CHANGE_LOG}}"
                  },
                  {
                    "name": "CI_ENVIRONMENT_NAME",
                    "value": "{{tasks.change-log.outputs.parameters.CI_ENVIRONMENT_NAME}}"
                  }
                ]
              },
              "depends": "clone.Succeeded && change-log.Succeeded"
            },
            {
              "name": "preflight",
              "template": "preflight",
              "arguments": {
                "parameters": [
                  {
                    "name": "GIT_PUSH_REF",
                    "value": "{{workflow.parameters.GIT_PUSH_REF}}"
                  },
                  {
                    "name": "GIT_CHECKOUT_SHA",
                    "value": "{{workflow.parameters.GIT_CHECKOUT_SHA}}"
                  },
                  {
                    "name": "PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME",
                    "value": "{{workflow.parameters.PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}}"
                  },
                  {
                    "name": "GIT_BEFORE_SHA",
                    "value": "{{workflow.parameters.GIT_BEFORE_SHA}}"
                  },
                  {
                    "name": "PREVIOUS_CHECKOUT_SHA",
                    "value": "{{workflow.outputs.parameters.PREVIOUS_CHECKOUT_SHA}}"
                  },
                  {
                    "name": "_MANUAL_",
                    "value": "{{workflow.parameters._MANUAL_}}"
                  }
                ]
              },
              "depends": "clone"
            },
            {
              "name": "build",
              "template": "build",
              "arguments": {
                "artifacts": [
                  {
                    "name": "dependencies-list",
                    "from": "{{tasks.preflight.outputs.artifacts.dependencies-list}}"
                  }
                ]
              },
              "depends": "preflight"
            },
            {
              "name": "result-to-json-list",
              "template": "result-to-json-list",
              "arguments": {
                "artifacts": [
                  {
                    "name": "artifacts-list",
                    "from": "{{tasks.build.outputs.artifacts.artifacts-list}}"
                  }
                ]
              },
              "depends": "build"
            },
            {
              "name": "docker-build",
              "template": "container",
              "arguments": {
                "parameters": [
                  {
                    "name": "APPNAME",
                    "value": "{{item.appname}}"
                  },
                  {
                    "name": "CONTEXT_ROOT",
                    "value": "{{item.dir}}"
                  },
                  {
                    "name": "CI_REGISTRY_URL",
                    "value": "{{workflow.parameters.CI_REGISTRY_URL}}"
                  },
                  {
                    "name": "REGISTRY_CREDENTIAL_SECRET_NAME",
                    "value": "{{workflow.parameters.REGISTRY_CREDENTIAL_SECRET_NAME}}"
                  },
                  {
                    "name": "CI_COMMIT_SHORT_SHA",
                    "value": "{{workflow.outputs.parameters.CI_COMMIT_SHORT_SHA}}"
                  },
                  {
                    "name": "CONTAINER_PLATFORM",
                    "value": "linux/amd64"
                  }
                ]
              },
              "withParam": "{{tasks.result-to-json-list.outputs.result}}",
              "depends": "result-to-json-list.Succeeded"
            },
            {
              "name": "sync-deploy",
              "template": "sync-deploy",
              "arguments": {
                "parameters": [
                  {
                    "name": "GIT_DEPLOY_REPOSITORY_URL",
                    "value": "{{workflow.parameters.GIT_DEPLOY_REPOSITORY_URL}}"
                  },
                  {
                    "name": "aggregate-results",
                    "value": "{{tasks.docker-build.outputs.result}}"
                  },
                  {
                    "name": "GIT_DEPLOY_BRANCH_NAME",
                    "value": "{{workflow.parameters.GIT_DEPLOY_BRANCH_NAME}}"
                  }
                ]
              },
              "depends": "docker-build.Succeeded"
            }
          ]
        }
      },
      "namespaced/ci-java-jagat/notification": {
        "name": "notification",
        "inputs": {
          "parameters": [
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "0000000000000000000000000000000000000000",
              "description": "上一次成功执行任务的SHA,默认值0000000000000000000000000000000000000000"
            },
            {
              "name": "GIT_CHECKOUT_SHA",
              "description": "本次触发任务的 SHA"
            },
            {
              "name": "GIT_REPOSITORY_URL"
            },
            {
              "name": "GIT_PUSH_REF"
            },
            {
              "name": "GIT_REPOSITORY_NAME"
            },
            {
              "name": "TRIGGER_WORKFLOWS_JOB_AUTHOR"
            },
            {
              "name": "NOTIFICATION_DINGTALK_BOT_ADDR",
              "value": "http://dingtalk-bot.workflows.svc:8000"
            },
            {
              "name": "PROJECT_ID",
              "description": "源码仓库项目的ID"
            },
            {
              "name": "NOTIFICATION_CARD_TEMPLATE_ID",
              "description": "互动卡片模板ID"
            },
            {
              "name": "NOTIFICATION_OPEN_CONVERSATION_ID",
              "description": "互动卡片投递群聊ID"
            },
            {
              "name": "CHANGE_LOG",
              "description": "Git Change Log"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "description": "发布环境名称"
            }
          ]
        },
        "outputs": {},
        "metadata": {},
        "container": {
          "name": "commit-logs",
          "image": "fcr.fawve.cluster.ws/bitnami/git@sha256:c01f7167dcd8d680a5bef264cc8213e1648e247ec739d6b15ee98ef5a1b0a467",
          "command": [
            "bash",
            "-ec"
          ],
          "args": [
            "set -x\nfunction post_notification(){\n  local job_url\n  ns=$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace)\n  job_name=${ARGO_NODE_ID%-*}\n  card_ref_link=\"https://workflows.fawve.jagat.io/workflows/${ns}/${job_name}\"\n  trigger_workflows_job_author=${TRIGGER_WORKFLOWS_JOB_AUTHOR}\n  environment_name=${CI_ENVIRONMENT_NAME}\n  curl -XPOST {{ inputs.parameters.NOTIFICATION_DINGTALK_BOT_ADDR }}/customRobot/test4 -H \"Content-Type: application/x-www-form-urlencoded\" \\\n    -H \"x-card-template-id: ${NOTIFICATION_CARD_TEMPLATE_ID}\" \\\n    -H \"x-open-conversation-id: ${NOTIFICATION_OPEN_CONVERSATION_ID}\" \\\n    --data-urlencode \"markdown_content={{ inputs.parameters.CHANGE_LOG }}\" \\\n    --data-urlencode \"card_ref_link=${card_ref_link}\" \\\n    --data-urlencode \"commit_sha=${GIT_CHECKOUT_SHA}\" \\\n    --data-urlencode \"task_name=${job_name}\" \\\n    --data-urlencode \"repository={{ inputs.parameters.GIT_REPOSITORY_NAME }}\" \\\n    --data-urlencode \"project_id={{ inputs.parameters.PROJECT_ID }}\" \\\n    --data-urlencode \"author=${TRIGGER_WORKFLOWS_JOB_AUTHOR}\" \\\n    --data-urlencode \"branch=${GIT_PUSH_REF#refs/heads/}\" \\\n    --data-urlencode \"environment={{ inputs.parameters.CI_ENVIRONMENT_NAME }}\" \\\n    --data-urlencode \"card_template_id=${NOTIFICATION_CARD_TEMPLATE_ID}\" \\\n    --data-urlencode \"open_conversation_id=${NOTIFICATION_OPEN_CONVERSATION_ID}\"\n  echo \"INFO: 通知发送成功.\"\n}\npost_notification\n\n# debug hook\nif [[ ${TRIGGER_WORKFLOWS_JOB_AUTHOR} == \"中文\" ]]; then\n  sleep 1800\nfi\n"
          ],
          "workingDir": "/workspace",
          "env": [
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "{{inputs.parameters.PREVIOUS_CHECKOUT_SHA}}"
            },
            {
              "name": "TRIGGER_WORKFLOWS_JOB_AUTHOR",
              "value": "{{inputs.parameters.TRIGGER_WORKFLOWS_JOB_AUTHOR}}"
            },
            {
              "name": "GIT_CHECKOUT_SHA",
              "value": "{{inputs.parameters.GIT_CHECKOUT_SHA}}"
            },
            {
              "name": "GIT_PUSH_REF",
              "value": "{{inputs.parameters.GIT_PUSH_REF}}"
            },
            {
              "name": "NOTIFICATION_CARD_TEMPLATE_ID",
              "value": "{{inputs.parameters.NOTIFICATION_CARD_TEMPLATE_ID}}"
            },
            {
              "name": "NOTIFICATION_OPEN_CONVERSATION_ID",
              "value": "{{inputs.parameters.NOTIFICATION_OPEN_CONVERSATION_ID}}"
            }
          ],
          "resources": {},
          "volumeMounts": [
            {
              "name": "workspace",
              "mountPath": "/workspace"
            }
          ]
        }
      },
      "namespaced/ci-java-jagat/preflight": {
        "name": "preflight",
        "inputs": {
          "parameters": [
            {
              "name": "PREVIOUS_CHECKOUT_SHA",
              "value": "0000000000000000000000000000000000000000",
              "description": "上一次成功执行任务的SHA,默认值0000000000000000000000000000000000000000"
            },
            {
              "name": "GIT_PUSH_REF"
            },
            {
              "name": "GIT_CHECKOUT_SHA"
            },
            {
              "name": "GIT_BEFORE_SHA"
            },
            {
              "name": "PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME",
              "value": "{{workflow.parameters.PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}}"
            },
            {
              "name": "MAVEN_LOCAL_REPO_DIR",
              "value": "/workspace/repository"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "{{workflow.parameters.CI_ENVIRONMENT_NAME}}"
            },
            {
              "name": "MAVEN_OPTS",
              "value": "-Dhttps.protocols=TLSv1.2 -Dmaven.repo.local=$(MAVEN_LOCAL_REPO_DIR) -Dorg.slf4j.simpleLogger.showDateTime=false -Djava.awt.headless=true"
            },
            {
              "name": "MAVEN_CLI_OPTS",
              "value": "--batch-mode --no-transfer-progress --threads=1 --settings /workspace/settings.xml -Dmaven.test.skip=true -P k8s --fail-at-end -X"
            },
            {
              "name": "_MANUAL_",
              "value": "false"
            }
          ]
        },
        "outputs": {
          "parameters": [
            {
              "name": "CI_ENVIRONMENT_NAME",
              "valueFrom": {
                "path": "/tmp/CI_ENVIRONMENT_NAME"
              },
              "globalName": "CI_ENVIRONMENT_NAME"
            }
          ],
          "artifacts": [
            {
              "name": "dependencies-list",
              "path": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
            }
          ]
        },
        "metadata": {},
        "container": {
          "name": "",
          "image": "fcr.fawve.cluster.ws/maven:3.9-eclipse-tumurin-17",
          "command": [
            "bash",
            "-c"
          ],
          "args": [
            "# 日志函数\nlog_info() { echo \"[INFO] $1\"; }\nlog_error() { echo \"[ERROR] $1\" >&2; }\nlog_debug() { [[ \"${CI_DEBUG_TRACE:-false}\" == \"true\" ]] && echo \"[DEBUG] $1\"; }\n\n# Debug Mode\nif [[ ${CI_DEBUG_TRACE} == true ]]; then set -x; fi\nif [[ \"${_MANUAL_}\" == true ]]; then echo \"INFO:\\ 手动触发作业!\"; fi\necho \"INFO: 查找需要编译发布的模块列表 ....\"\necho \"INFO: GIT_CHECKOUT_SHA:{{inputs.parameters.GIT_CHECKOUT_SHA}} \n      GIT_BEFORE_SHA:{{inputs.parameters.GIT_BEFORE_SHA}}\"\necho -e \"${CI_COMMIT_MESSAGE}\\n\\n\"\n\n# 适配多版本 jdk 编译需求\nJDK_VERSION_MAJOR=$(java --version &> /dev/stdout | grep -Po '(?<=openjdk ).*?(?=\\.)')\nMAVEN_LOCAL_REPO_DIR=${MAVEN_LOCAL_REPO_DIR}/repository-${JDK_VERSION_MAJOR}\necho \"INFO: Maven local repository dir -> ${MAVEN_LOCAL_REPO_DIR}\"\n\nif [[ \"{{inputs.parameters.PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}}\" ]]; then\n  echo \"INFO: 获取到预定义 PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME 为 {{inputs.parameters.PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}}\"\nelse\n  echo -e \"INFO: 开始自动获取 Project Dependency Group Name \\x1b[;5m....\\x1b[0m\"\n  mvn -Dmaven.test.skip=true --batch-mode --no-transfer-progress --settings /workspace/settings.xml --fail-at-end -X verify | tee /tmp/verify_out.log\n  grep -Po '(?<=< ).*(?= >)' /tmp/verify_out.log > /tmp/group.log\n  PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME=$(cat /tmp/group.log | awk -F: '{print $1}' | sort | uniq | paste -sd,)\n  echo -e \"INFO: 获取到当前 PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME 为 \\x1b[32m${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}\\x1b[0m\"\nfi\n\n## 开始处理分支与环境的对应关系\n## eg:\n##  >_ cat ${project-root:-.}/environment-mapping.txt\n##  # branch   environment\n##  master     beta\n##  production prod\nif [[ -f environment-mapping.txt ]]; then\n  echo \"INFO: 检测到 environment-mapping.txt 项目环境配置文件\"\n  CI_ENVIRONMENT_NAME=$(awk \"/^${GIT_PUSH_REF#refs/heads/}/{print \\$2}\" environment-mapping.txt)\nelse\n  echo \"INFO: 未检测到 environment-mapping.txt 项目环境配置文件，环境名称将默认采用 branch 名称.\"\n  CI_ENVIRONMENT_NAME=${GIT_PUSH_REF#refs/heads/}\nfi\necho ${CI_ENVIRONMENT_NAME} > /tmp/CI_ENVIRONMENT_NAME\necho \"INFO: 环境名称 ${CI_ENVIRONMENT_NAME}\"\n\n# 获取 monorepo 项目的子父模块依赖关系\necho \"INFO: 获取 monorepo 项目的模块依赖关系\"\nmvn ${MAVEN_CLI_OPTS} dependency:tree -Dincludes=\"${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}\" | tee \"${MVN_LOG_FILE}\"\nPROJECT_DEPENDENCY_INCLUDE_GROUP_NAME_ON_SHELL=$(echo ${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME} | sed 's/,/\\|/g')\necho \"DEBUG: PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME_ON_SHELL value is ${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME_ON_SHELL}\"\n\ncat \"${MVN_LOG_FILE}\" | sed -En '/^\\[INFO\\]\\s'${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME_ON_SHELL}':.*:jar:/,/^\\[INFO\\]\\s?[-]*$/p' | \\\n  grep -E '^\\[INFO\\]' | \\\n  sed -E 's/^\\[INFO\\]\\s-+$/\\[INFO\\] /' \\\n  > ${PROJECT_DEPENDENCY_TREE_FILE}\nif [[ $(cat ${PROJECT_DEPENDENCY_TREE_FILE} | wc -l) -gt 1 ]]; then\n  echo \"DEBUG: PROJECT_DEPENDENCY_TREE_FILE 文件 ${PROJECT_DEPENDENCY_TREE_FILE} 结果如下\"\n  cat ${PROJECT_DEPENDENCY_TREE_FILE}\nelse\n  echo \"ERROR: PROJECT_DEPENDENCY_TREE_FILE 文件 ${PROJECT_DEPENDENCY_TREE_FILE} 为空行.\"\n  exit 1\nfi\n\n# 获取 Maven 反应堆输出的模块 pom.xml 文件路径与module对应关系\nREACTOR_PROJECT_MAPPING_FILE=reactorProject_mapping.txt\n# [TODO] 检查 \"${MVN_LOG_FILE}\" 文件是否正常\n# 注意：maven-dependency-plugin 插件版本在 3.7.x 及以上版本中，DEBUG 输出中不再包含 \n# \"project = MavenProject: io.jagat:notify-server:2.1.0-SNAPSHOT @ D:\\IDEA-Projects\\utown\\notify-server\\pom.xml\" 信息，\n# 会导致无法产生 reactorProject 与 pom.xml 的对应关系.\ncat \"${MVN_LOG_FILE}\" | sed -En '/\\[DEBUG\\]\\s+\\(f\\)\\sproject\\s=\\sMavenProject:/p' > \"${REACTOR_PROJECT_MAPPING_FILE}\"\nif [[ \"$(stat -c %s ${REACTOR_PROJECT_MAPPING_FILE})\" -le 1 ]]; then\n  echo \"ERROR: REACTOR_PROJECT_MAPPING_FILE 文件 ${REACTOR_PROJECT_MAPPING_FILE} 大小为空，无法获取 reactorProject 与 pom.xml 文件的对应关系.\"\n  rm -rf ${REACTOR_PROJECT_MAPPING_FILE}\nfi\n\n# 检查输入文件是否存在\nif [ ! -f \"${PROJECT_DEPENDENCY_TREE_FILE}\" ] || [ ! -f \"${REACTOR_PROJECT_MAPPING_FILE}\" ]; then\n  echo \"错误：缺少必要的依赖关系文件\"\n  exit 1\nfi\n\nARTIFACT_INDICATORS=(\"Dockerfile.${CI_ENVIRONMENT_NAME}\" \"run.sh\" \"env.sh\")      # 用于识别需要构建制品的模块的标志文件\n\n# 声明关联数组\ndeclare -A MODULE_PATHS      # 存储模块的路径\ndeclare -A DEPENDENCIES      # 存储模块的依赖关系\ndeclare -A AFFECTED_MODULES  # 存储受影响的模块\ndeclare -A ARTIFACT_MODULES  # 存储需要构建制品的模块\n\n# 检查目录是否包含制品标志文件\nis_artifact_module() {\n  local module_path=\"$1\"\n  for indicator in \"${ARTIFACT_INDICATORS[@]}\"; do\n    if [[ -f \"${module_path}/${indicator}\" ]]; then\n      return 0\n    fi\n  done\n  return 1\n}\n\n# 解析模块路径\nparse_module_paths() {\n  while IFS= read -r line; do\n  if [[ $line =~ MavenProject:\\ ([^:]+):([^:]+):([^\\ @]+)\\ @\\ (/.+)pom.xml ]]; then\n    local group_id=\"${BASH_REMATCH[1]}\"\n    local artifact_id=\"${BASH_REMATCH[2]}\"\n    local version=\"${BASH_REMATCH[3]}\"\n    local path=\"${BASH_REMATCH[4]}\"\n    local module_key=\"${group_id}:${artifact_id}:${version}\"\n    path=${path#$PWD/}\n    [[ $path == \"\" ]] && continue     # 忽略顶级pom.xml\n\n    MODULE_PATHS[\"$module_key\"]=\"$path\"\n\n    # 检查是否为制品模块\n    if is_artifact_module \"$path\"; then\n        ARTIFACT_MODULES[\"$module_key\"]=1\n        log_debug \"发现制品模块: $module_key at $path\"\n    fi\n  fi\n  done < \"${REACTOR_PROJECT_MAPPING_FILE}\"\n}\n\n# 解析依赖关系\nparse_dependencies() {\n  local current_module=\"\"\n  while IFS= read -r line; do\n    # 检测模块声明行\n    if [[ $line =~ \\[INFO\\]\\ ([^:\\\\+|]+):([^:]+):(jar|pom):([^\\ ]+) ]]; then\n      current_module=\"${BASH_REMATCH[1]}:${BASH_REMATCH[2]}:${BASH_REMATCH[4]}\"\n      DEPENDENCIES[\"$current_module\"]=\"\"\n    # 检测依赖行\n    elif [[ $line =~ \\[INFO\\]\\ [+\\\\|-]+-\\ ([^:]+):([^:]+):jar:([^:]+) ]] && [ ! -z \"$current_module\" ]; then\n      local dep=\"${BASH_REMATCH[1]}:${BASH_REMATCH[2]}:${BASH_REMATCH[3]}\"\n      DEPENDENCIES[\"$current_module\"]+=\"$dep \"\n    fi\n  done < \"${PROJECT_DEPENDENCY_TREE_FILE}\"\n}\n\n# 递归查找依赖此模块的所有模块\nfind_dependent_modules() {\n  local target_module=\"$1\"\n  for module in \"${!DEPENDENCIES[@]}\"; do\n    local deps=\"${DEPENDENCIES[$module]}\"\n    if [[ $deps =~ $target_module ]]; then\n      AFFECTED_MODULES[\"$module\"]=1\n      find_dependent_modules \"$module\"\n  fi\n  done\n}\n\n# 检查变更的目录并确定受影响的模块\ncheck_changes() {\n  local changed_path=\"$1\"\n  # 查找变更路径对应的模块\n  for module in \"${!MODULE_PATHS[@]}\"; do\n    local path=\"${MODULE_PATHS[$module]}\"\n    if [[ \"$changed_path\" == \"$path\"* ]]; then\n      AFFECTED_MODULES[\"$module\"]=1\n      find_dependent_modules \"$module\"\n    break\n  fi\n  done\n}\n\n# 输出结果\nprint_results() {\n  for module in \"${!ARTIFACT_MODULES[@]}\"; do\n    echo \"  - $module (${MODULE_PATHS[$module]})\"\n  done\n\n  log_info \"需要重新构建的模块:\"\n  local found_artifact=false\n  for module in \"${!AFFECTED_MODULES[@]}\"; do\n    if [[ -n \"${ARTIFACT_MODULES[$module]}\" ]]; then\n      echo \"  - $module (${MODULE_PATHS[$module]})\"\n      found_artifact=true\n    fi\n  done\n  [[ \"$found_artifact\" == \"false\" ]] && echo \"  没有需要重建的制品模块\"\n}\nparse_module_paths\nparse_dependencies\n\n## tools functions\nfunction get_pom_path_by_artifactId(){\n  local artifact_id\n  if [[ -z $1 ]]; then\n    return\n  else\n    artifact_id=\"$1\"\n  fi\n  awk -F'@ ' -v pwd=\"$PWD/\" -v artifact=$artifact_id '$0 ~ artifact{gsub(pwd, \"\", $2);print $2}' \"${REACTOR_PROJECT_MAPPING_FILE}\"\n}\nfunction get_artifactId_by_pom_path(){\n  # 根据 pom 路径获取子模块的 artifactId\n  local pom_path\n  if [[ -z $1 ]]; then\n    return\n  else\n    pom_path=\"$1\"\n  fi\n  awk -v pom=$pom_path '$0 ~ pom{print $6}' \"${REACTOR_PROJECT_MAPPING_FILE}\" | awk -F: '{print $1\":\"$2\":\"}'\n}\n\n### 在 dependency:tree 日志中过滤项目模块依赖关系, 逻辑待定\n#while read -r line; do\n#  C_NAME=$(echo $line | grep -cP '(?<=^\\[INFO\\]\\ '${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}':).*(?=:jar:.*$)')\n#  if [[ $C_NAME -eq 1 ]]; then\n#    # 取出首行模块名称，模块的依赖不会被匹配，所以 app_artifact_id 在一个依赖树中不会被覆盖\n#    app_artifact_id=$(echo $line | grep -oP '(?<=^\\[INFO\\]\\ )'${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}':.*:(?=jar:.*$)')\n#  fi\n#  C_END=$(echo $line | grep -Ec '^\\[INFO\\]\\ ?$')\n#  if [[ $C_END -ne 0 ]]; then\n#    ## 进入结尾步骤\n#    mv /tmp/temp.txt /tmp/split_${app_artifact_id}.txt\n#  else\n#    ## 继续向下匹配\n#    if [[ x${CI_DEBUG_TRACE} == \"xtrue\" ]]; then echo \"DEBUG: 继续遍历 ${app_artifact_id} 的依赖包\"; fi\n#    echo $line >> /tmp/temp.txt\n#  fi\n#done < ${PROJECT_DEPENDENCY_TREE_FILE}\n#\n#if [[ x${CI_DEBUG_TRACE} == \"xtrue\" ]]; then ls -lh /tmp/split_*.txt; fi\n\n## 根据 tag 和分支的上一次成功流水线，对比与当前commit的提交记录变更，获取变更文件列表\nif [[ $CI_COMMIT_TAG != \"\" ]]; then\n  ## tag 创建的时候，GIT_BEFORE_SHA 始终为 000...000，因此需要检测是否有上一次 tag 提交\n  while read -r line; do \n    # 取上一次 tag 名称\n    echo $line\n    if [[ $line != ${CI_COMMIT_TAG} ]]; then \n      LAST_TAG=$line \n    fi\n  done < <(git tag --sort=-v:refname | grep -A 1 ${CI_COMMIT_TAG})\n  if [[ $LAST_TAG != \"\" ]]; then\n  # 根据上一次tag名称取上一次tag的commit id\n    GIT_BEFORE_SHA=$(git rev-list -n 1 ${LAST_TAG})\n  else\n  # 否则进行全量发布\n    _MANUAL_=true\n  fi\nelse\n  echo \"INFO: 取上一次 ${GIT_PUSH_REF} 分支流水线成功的 commitID\"\n  ## Gitlab API\n  #PREVIOUS_HASH=$(curl -s -H \"PRIVATE-TOKEN:${GITLAB_TOKEN}\" \"${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/pipelines?ref=${GIT_PUSH_REF}&status=success&per_page=1\")\n  ## Argo-Workflows\n  PREVIOUS_HASH={{inputs.parameters.PREVIOUS_CHECKOUT_SHA}}\n  C=$(echo ${PREVIOUS_HASH} | grep -cE '[0-9a-f]{40}') || true    ## return: 1 or 0\n  if [[ $C -eq 1 ]]; then\n    PREV_HASH=$(echo ${PREVIOUS_HASH} | grep -oE '[0-9a-f]{40}')\n    echo \"INFO: 从 CI 流水线历史中发现上次成功执行流水线的CommitID为 [${PREV_HASH}]\"\n    is_Commit_EXISTS=$(git cat-file -t ${PREV_HASH})   ## output: \"commit\"\n    if [[ ${is_Commit_EXISTS} == \"commit\" ]]; then\n      echo \"DEBUG: 从本地Git库中检测到 [${PREV_HASH}] 的存在\"\n      GIT_BEFORE_SHA=\"${PREV_HASH}\"\n    else\n      echo \"WARN: 从本地库中未检测到 [${PREV_HASH}] 的存在，执行保底策略，从本地rev-list的初始提交开始拉取变更....\"\n      GIT_BEFORE_SHA=$(git rev-list --max-parents=0 HEAD)\n      echo \"INFO: 初始CommitID为 [$GIT_BEFORE_SHA]\"\n    fi\n  else\n    echo \"WARN: 未探测到上次成功执行的流水线，开始执行全量编译.\"\n    _MANUAL_=true\n  fi\nfi\n\n> ${MAVEN_BUILD_PROJECT_DIR_FILE}      # 初始化空文件\n\n## 当触发合并提交时，Gitlab CI_COMMIT_BEFORE_SHA 值为 000000，此时需要重新获取上一次本分支提交的 Commit ID\necho \"INFO: 进入本地提交变更检测阶段，检测项目顶级 pom.xml 是否变更，对比 $GIT_CHECKOUT_SHA --> $GIT_BEFORE_SHA 的提交变更...\"\nfor dir in $(git diff --name-only $GIT_CHECKOUT_SHA $GIT_BEFORE_SHA | awk -F'(/src/|/Dockerfile.'${CI_ENVIRONMENT_NAME}'|/pom.xml|/env.sh|/run.sh$)' '{print $1}' | sort -u); do \n    if [[ \"${dir}\" == \"pom.xml\" ]]; then \n      echo \"INFO: 检测到顶级 pom.xml 发生变更，开始执行全量编译.\"\n      _MANUAL_=true\n    fi\ndone\n\n## 全量发布逻辑\nif [[ \"$_MANUAL_\" == \"true\" ]]; then\n  ## 手动触发流水线埋入变量 _MANUAL_  值置为 true 即为触发全量发布\n  if [[ x$CI_DEBUG_TRACE == \"xtrue\" ]]; then ls -lh; fi\n  echo \"INFO: 检测到全量发布新分支.\"\n  echo \"INFO: 将要全量编译的模块...\"\n  ## 获取所有模块列表，${MAVEN_BUILD_PROJECT_DIR_FILE} 文件内容为 --> 模块group:artifact:名称   pom_dir\n  grep -oP '(?<=\\[INFO\\]\\s)[a-z].*$' ${PROJECT_DEPENDENCY_TREE_FILE} > /tmp/all_modules.txt\n  while read -r line; do\n    module=$(echo $line | awk -F: '{print $1\":\"$2\":\"}')\n    pom_dir=$(dirname $(get_pom_path_by_artifactId \"$module\"))\n    if [[ -f ${pom_dir}/Dockerfile.${CI_ENVIRONMENT_NAME} ]]; then\n      printf \"%10s 模块:\\x1b[32m%30s\\x1b[0m 目录位于:%-50s\\n\"  \"$Indent\" \"[${module}]\" \"${pom_dir}\"\n      echo \"${module}\" \"${pom_dir}\" >> ${MAVEN_BUILD_PROJECT_DIR_FILE}\n    else\n      printf \"\\x1b[90m%10s 模块:%30s 无需发布, %s\\x1b[0m\\n\" \"$Indent\" \"[${module}]\" \"未找到${pom_dir}/Dockerfile.${CI_ENVIRONMENT_NAME}文件.\"\n    fi\n  done < /tmp/all_modules.txt\nelif [[ \"$_MANUAL_\" != \"true\" ]]; then\n  # 进入探测 Git 变更部分编译阶段\n  if [[ \"${CI_COMMIT_BEFORE_SHA}\" == \"0000000000000000000000000000000000000000\" ]]; then \n    echo \"INFO: 执行最近上一次提交的变更探测...\"\n    CI_COMMIT_BEFORE_SHA=$(git rev-parse HEAD~1)\n  fi\n  ## 当触发合并提交时，Gitlab CI_COMMIT_BEFORE_SHA 值为 000000，此时需要重新获取上一次本分支提交的 Commit ID\n  echo \"INFO: 进入本地提交变更检测阶段，对比 $GIT_CHECKOUT_SHA --> $GIT_BEFORE_SHA 的提交变更...\"\n  echo \"INFO: command [git diff --name-only $GIT_CHECKOUT_SHA $GIT_BEFORE_SHA]\"\n  for dir in $(git diff --name-only $GIT_CHECKOUT_SHA $GIT_BEFORE_SHA | awk -F'(/src/|/Dockerfile.'${CI_ENVIRONMENT_NAME}'|/pom.xml|/env.sh|/run.sh$)' '{print $1}' | sort -u); do \n    if [[ ! -d ${dir} ]]; then \n      ## 如果不是目录，则跳过\n      continue\n    fi\n    if [[ ! -f ${dir}/Dockerfile.${CI_ENVIRONMENT_NAME} ]]; then\n      check_changes \"${dir}/\"\n      for module in \"${!AFFECTED_MODULES[@]}\"; do\n        if [[ -n \"${ARTIFACT_MODULES[$module]}\" ]]; then\n          echo \"INFO: 探测到依赖变更，需要打包的Maven模块 [${module}] 目录位于 ${MODULE_PATHS[$module]}\"\n          if grep -q \"${MODULE_PATHS[$module]}\" ${MAVEN_BUILD_PROJECT_DIR_FILE}; then\n            echo \"INFO: 已存在${module},跳过本轮探测..\"\n          else\n            echo \"$module ${MODULE_PATHS[$module]}\" >> \"$MAVEN_BUILD_PROJECT_DIR_FILE\"\n            found_artifact=true\n          fi\n        fi\n      done\n    #  ## 如果没有 Dockerfile，可能为依赖模块，走依赖判定流程\n    #  # 查找所有具有依赖关系的模块名称\n    #  artifact=$(get_artifactId_by_pom_path ${dir})\n    #  ARTIFACTID_IDs=$(grep \"${artifact}\" /tmp/split_*.txt | grep -oP '(?<=split_).*(?=.txt)') || true\n    #  if [[ ${ARTIFACTID_IDs} != \"\" ]]; then\n    #    for module in ${ARTIFACTID_IDs}; do\n    #      pom_dir=$(dirname $(get_pom_path_by_artifactId ${module}))\n    #      if [[ -f ${pom_dir}/Dockerfile.${CI_ENVIRONMENT_NAME} ]]; then\n    #        is_module_dir_exists=$(cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | grep -c ${pom_dir}) || true  ## Count\n    #        if [[ ${is_module_dir_exists} -lt 1 ]]; then\n    #          echo \"INFO: 探测到依赖变更，需要打包的Maven模块 [${module}] 目录位于 ${pom_dir}\"\n    #          echo \"${module}\" \"${pom_dir}\" >> ${MAVEN_BUILD_PROJECT_DIR_FILE}\n    #        fi\n    #      fi\n    #    done\n    #  fi\n      ## 进行下一轮探测,跳出本轮循环\n      continue\n    fi\n    module=$(get_artifactId_by_pom_path ${dir})   # 获取模块的 artifact 名称\n    if [[ $(grep -c $module $MAVEN_BUILD_PROJECT_DIR_FILE) -lt 1 ]]; then\n      echo \"INFO: 将要编译打包模块 [${module%:}] 目录位于 ${dir}/ ...\"\n      if grep -q \"${dir}/\" ${MAVEN_BUILD_PROJECT_DIR_FILE}; then\n        echo \"INFO: 已存在${dir}/,跳过本轮探测..\"\n      else\n        echo \"${module}\" \"${dir}/\" >> $MAVEN_BUILD_PROJECT_DIR_FILE\n      fi\n    fi\n  done\nfi\nif [[ $(cat $MAVEN_BUILD_PROJECT_DIR_FILE | wc -l) -ge 1 ]]; then\n  echo \"INFO: ↓↓↓↓↓↓ 需要编译的模块列表 ↓↓↓↓↓↓\"\n  cat $MAVEN_BUILD_PROJECT_DIR_FILE\n  echo \"INFO: 请稍后确认 CI 流程maven编译阶段是否成功运行\"\nelse\n  echo -e \"\\e[33;5mWARN:\\e[0m 未找到需要编译的模块列表，请确认 commit:$GIT_CHECKOUT_SHA 的代码变更在流水线检测范围内。\"\n  false\nfi\n"
          ],
          "workingDir": "/workspace",
          "env": [
            {
              "name": "GIT_PUSH_REF",
              "value": "{{inputs.parameters.GIT_PUSH_REF}}"
            },
            {
              "name": "GIT_CHECKOUT_SHA",
              "value": "{{inputs.parameters.GIT_CHECKOUT_SHA}}"
            },
            {
              "name": "MAVEN_LOCAL_REPO_DIR",
              "value": "{{inputs.parameters.MAVEN_LOCAL_REPO_DIR}}"
            },
            {
              "name": "MAVEN_OPTS",
              "value": "{{inputs.parameters.MAVEN_OPTS}}"
            },
            {
              "name": "MAVEN_CLI_OPTS",
              "value": "{{inputs.parameters.MAVEN_CLI_OPTS}}"
            },
            {
              "name": "MAVEN_BUILD_PROJECT_DIR_FILE",
              "value": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
            },
            {
              "name": "PROJECT_DEPENDENCY_TREE_FILE",
              "value": "dependencies.txt"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "{{inputs.parameters.CI_ENVIRONMENT_NAME}}"
            },
            {
              "name": "CI_DEBUG_TRACE",
              "value": "{{workflow.parameters.CI_DEBUG_TRACE}}"
            },
            {
              "name": "MVN_LOG_FILE",
              "value": "mvn.log"
            },
            {
              "name": "_MANUAL_",
              "value": "{{inputs.parameters._MANUAL_}}"
            }
          ],
          "resources": {},
          "volumeMounts": [
            {
              "name": "workspace",
              "mountPath": "/workspace"
            },
            {
              "name": "maven-settings",
              "mountPath": "/workspace/settings.xml",
              "subPath": "settings.xml"
            },
            {
              "name": "maven-repository-cache",
              "mountPath": "/workspace/repository"
            }
          ]
        }
      },
      "namespaced/ci-java-jagat/result-to-json-list": {
        "name": "result-to-json-list",
        "inputs": {
          "artifacts": [
            {
              "name": "artifacts-list",
              "path": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
            }
          ]
        },
        "outputs": {},
        "metadata": {},
        "script": {
          "name": "regular-to-json",
          "image": "dellnoantechnp/git-yq:2.42",
          "command": [
            "bash",
            "-e"
          ],
          "env": [
            {
              "name": "MAVEN_BUILD_PROJECT_DIR_FILE",
              "value": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
            }
          ],
          "resources": {},
          "source": "cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | jq -MRn '[inputs]|map(split(\" \") | {\"app\":.[0],\"dir\":.[1],\"jar_path\":.[2],\"appname\":.[3]})'\n"
        }
      },
      "namespaced/ci-java-jagat/sync-deploy": {
        "name": "sync-deploy",
        "inputs": {
          "parameters": [
            {
              "name": "GIT_DEPLOY_REPOSITORY_URL"
            },
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "{{workflow.outputs.parameters.CI_COMMIT_SHORT_SHA}}"
            },
            {
              "name": "GIT_REPOSITORY_URL",
              "value": "{{workflow.parameters.GIT_REPOSITORY_URL}}"
            },
            {
              "name": "GIT_DEPLOY_BRANCH_NAME",
              "value": "main"
            },
            {
              "name": "aggregate-results"
            }
          ]
        },
        "outputs": {},
        "metadata": {},
        "script": {
          "name": "git-yq",
          "image": "dellnoantechnp/git-yq:2.44",
          "command": [
            "bash",
            "-e"
          ],
          "workingDir": "/workspace",
          "env": [
            {
              "name": "CI_ENVIRONMENT_NAME",
              "value": "{{inputs.parameters.CI_ENVIRONMENT_NAME}}"
            },
            {
              "name": "GIT_USER",
              "valueFrom": {
                "secretKeyRef": {
                  "name": "git-deploy-repository-credential",
                  "key": "GIT_USER"
                }
              }
            },
            {
              "name": "GIT_PASSWORD",
              "valueFrom": {
                "secretKeyRef": {
                  "name": "git-deploy-repository-credential",
                  "key": "GIT_PASSWORD"
                }
              }
            },
            {
              "name": "GIT_CREDENTIAL_TYPE",
              "valueFrom": {
                "secretKeyRef": {
                  "name": "git-deploy-repository-credential",
                  "key": "GIT_CREDENTIAL_TYPE"
                }
              }
            },
            {
              "name": "GIT_SSH_PRIVATEKEY",
              "valueFrom": {
                "secretKeyRef": {
                  "name": "git-deploy-repository-credential",
                  "key": "GIT_SSH_PRIVATEKEY",
                  "optional": true
                }
              }
            }
          ],
          "resources": {},
          "volumeMounts": [
            {
              "name": "workspace",
              "mountPath": "/workspace"
            }
          ],
          "source": "## Login settings\ncase \"${GIT_CREDENTIAL_TYPE}\" in\n  SSH|ssh)\n    echo \"INFO: git clone method by [SSH]\"\n    (umask 077 ; echo \"${GIT_SSH_PRIVATEKEY}\" > /git_key)\n    git config --global core.sshCommand 'ssh -i /git_key -o StrictHostKeyChecking=false'\n  ;;\n  *)\n    # https://git-scm.com/docs/gitcredentials store password\n    echo \"INFO: git clone method by [HTTPS]\"\n    git config --global credential.\"{{inputs.parameters.GIT_DEPLOY_REPOSITORY_URL}}\".username \"${GIT_USER}\"\n    git config --global credential.\"{{inputs.parameters.GIT_DEPLOY_REPOSITORY_URL}}\".helper '!p(){ echo \"password=\"${GIT_PASSWORD}\"\";}; p'\n  ;;\nesac\ngit config --global user.name Robot\ngit config --global user.email robot@lerjin.com\n# 清理 deploy 目录，避免冲突\n[[ -d deploy ]] && rm -rf deploy\necho \">_ git clone --branch \"{{inputs.parameters.GIT_DEPLOY_BRANCH_NAME}}\" \"{{inputs.parameters.GIT_DEPLOY_REPOSITORY_URL}}\" deploy\"\ngit clone --branch \"{{inputs.parameters.GIT_DEPLOY_BRANCH_NAME}}\" \"{{inputs.parameters.GIT_DEPLOY_REPOSITORY_URL}}\" deploy\n\n_jq() {\n  ## jq 获取指定字段值\n  echo ${row} | base64 -d | jq -r ${1}\n}\n_sc() {\n  ## console 输出文字颜色标注\n  local regex_pattern=\"$1\"\n  sed \"s@\\(${regex_pattern}\\)@\\x1b[31m\\1\\x1b[0m@\" $2\n}\ncd deploy/\nfor row in $(echo '{{inputs.parameters.aggregate-results}}' | jq -r '.[] | @base64'); do\n  APPNAME=$(_jq '.APPNAME')\n  CONTEXT_ROOT=$(_jq '.CONTEXT_ROOT')\n  CI_ENVIRONMENT_NAME=$(_jq '.CI_ENVIRONMENT_NAME')\n  IMAGE_NAME=$(_jq '.IMAGE_NAME')\n  IMAGE_NAME_DIGEST=$(_jq '.IMAGE_NAME_DIGEST')\n  CI_COMMIT_SHORT_SHA=$(_jq '.CI_COMMIT_SHORT_SHA')\n  #APP_RESOURCE_DEFINE_FILE_PATH=\"overlays/${CI_ENVIRONMENT_NAME}/deploy/${APPNAME}.yaml\"\n  APP_RESOURCE_DEFINE_FILE_PATH=\"overlays/${CI_ENVIRONMENT_NAME}/${APPNAME}.yaml\"\n  yq -i '(select(.kind == \"Deployment\") | .spec.template.spec.containers[] | select(.name == \"'${APPNAME}'\")) .image = \"'${IMAGE_NAME_DIGEST}'\"' ${APP_RESOURCE_DEFINE_FILE_PATH}\n  yq -i '(select(.kind == \"Deployment\") | .spec.template.metadata.labels.version) = \"'${CI_COMMIT_SHORT_SHA}'\"' ${APP_RESOURCE_DEFINE_FILE_PATH}\n  _sc \"${IMAGE_NAME}\" ${APP_RESOURCE_DEFINE_FILE_PATH}\n  grep \"${IMAGE_NAME}\" ${APP_RESOURCE_DEFINE_FILE_PATH} > /dev/null 2>&1 && CURRENT_STAT=\"${CURRENT_STAT}./${CONTEXT_ROOT} -> ${APPNAME} \\x1b[32mSuccess\\x1b[0m\\n\" || CURRENT_STAT=\"${CURRENT_STAT}./${CONTEXT_ROOT} -> ${APPNAME} \\x1b[31mFailed\\x1b[0m\\n\" \n  printf \"\\n%-40s\\n\" \"=\"|sed \"s/ /=/g\"\ndone\n\necho \"======= sync-deploy information ========\"\necho -e \"${CURRENT_STAT}\" | column -t\n\ngit commit -sa -m \"[WorkflowRobot]: Push back from {{inputs.parameters.GIT_REPOSITORY_URL}}\" && \\\ngit pull --rebase=true && git push && \\\ngit credential-cache exit\n"
        }
      }
    },
    "persistentVolumeClaims": [
      {
        "name": "workspace",
        "persistentVolumeClaim": {
          "claimName": "cicd-java-main-finance-b38758a4-hhjbb-workspace"
        }
      }
    ],
    "outputs": {
      "parameters": [
        {
          "name": "PREVIOUS_CHECKOUT_SHA",
          "value": "0000000000000000000000000000000000000000"
        },
        {
          "name": "CI_COMMIT_SHORT_SHA",
          "value": "b38758a"
        },
        {
          "name": "CI_COMMIT_MESSAGE",
          "value": "feat: 触发打包\n"
        },
        {
          "name": "CHANGE_LOG",
          "value": "From: Last10..HEAD\n- dellnoantechnp (6):\n    84b99ce (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    aa95a87 (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    e37f4be (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    ebcb669 (6 months ago) feat: add liquibase-test model.\n    d9e032e (5 months ago) feat: add liquibase-test model.\n    d67ea36 (4 weeks ago) feat: update Dockerfile.dev\n\n- eric (4):\n    eb5992c (1 year, 1 month ago) dev: product 增加方法调用，测试调用链, 增加 addEvent 方法\n    69d348c (6 months ago) feat: product 增加 druid 配置\n    f434a51 (4 weeks ago) feat: 增加 workflows cicd 的环境映射配置文件\n    b38758a (5 days ago) feat: 触发打包\n"
        },
        {
          "name": "CI_ENVIRONMENT_NAME",
          "value": "dev"
        }
      ]
    },
    "conditions": [
      {
        "type": "PodRunning",
        "status": "True"
      },
      {
        "type": "Completed",
        "status": "True"
      }
    ],
    "resourcesDuration": {
      "cpu": 42,
      "memory": 475
    },
    "storedWorkflowTemplateSpec": {
      "templates": [
        {
          "name": "main",
          "inputs": {},
          "outputs": {},
          "metadata": {},
          "dag": {
            "tasks": [
              {
                "name": "clone",
                "template": "clone",
                "arguments": {
                  "parameters": [
                    {
                      "name": "WORKFLOWS_API_DOMAIN",
                      "value": "{{workflow.parameters.WORKFLOWS_API_DOMAIN}}"
                    },
                    {
                      "name": "WORKFLOWS_API_NAMESPACE",
                      "value": "{{workflow.parameters.WORKFLOWS_API_NAMESPACE}}"
                    },
                    {
                      "name": "WORKFLOWS_API_PROJECT_ID",
                      "value": "{{workflow.parameters.WORKFLOWS_API_PROJECT_ID}}"
                    },
                    {
                      "name": "WORKFLOWS_API_REPOSITORY",
                      "value": "{{workflow.parameters.WORKFLOWS_API_REPOSITORY}}"
                    },
                    {
                      "name": "WORKFLOWS_API_BRANCH",
                      "value": "{{workflow.parameters.WORKFLOWS_API_BRANCH}}"
                    },
                    {
                      "name": "GIT_REPOSITORY_URL",
                      "value": "{{workflow.parameters.GIT_REPOSITORY_URL}}"
                    },
                    {
                      "name": "GIT_PUSH_REF",
                      "value": "{{workflow.parameters.GIT_PUSH_REF}}"
                    },
                    {
                      "name": "GIT_CHECKOUT_SHA",
                      "value": "{{workflow.parameters.GIT_CHECKOUT_SHA}}"
                    },
                    {
                      "name": "GIT_REPOSITORY_NAME",
                      "value": "{{workflow.parameters.GIT_REPOSITORY_NAME}}"
                    }
                  ]
                }
              },
              {
                "name": "previous-commit-sha",
                "template": "get-previous-successful-commit-sha",
                "arguments": {
                  "parameters": [
                    {
                      "name": "WORKFLOWS_API_DOMAIN",
                      "value": "{{workflow.parameters.WORKFLOWS_API_DOMAIN}}"
                    },
                    {
                      "name": "WORKFLOWS_API_NAMESPACE",
                      "value": "{{workflow.parameters.WORKFLOWS_API_NAMESPACE}}"
                    },
                    {
                      "name": "WORKFLOWS_API_PROJECT_ID",
                      "value": "{{workflow.parameters.WORKFLOWS_API_PROJECT_ID}}"
                    },
                    {
                      "name": "WORKFLOWS_API_REPOSITORY",
                      "value": "{{workflow.parameters.WORKFLOWS_API_REPOSITORY}}"
                    },
                    {
                      "name": "WORKFLOWS_API_BRANCH",
                      "value": "{{workflow.parameters.WORKFLOWS_API_BRANCH}}"
                    },
                    {
                      "name": "CURRENT_GIT_CHECKOUT_SHA",
                      "value": "{{workflow.parameters.GIT_CHECKOUT_SHA}}",
                      "description": "本次CI的commit SHA值"
                    }
                  ]
                }
              },
              {
                "name": "change-log",
                "template": "change-log",
                "arguments": {
                  "parameters": [
                    {
                      "name": "PREVIOUS_CHECKOUT_SHA",
                      "value": "{{workflow.outputs.parameters.PREVIOUS_CHECKOUT_SHA}}"
                    },
                    {
                      "name": "GIT_CHECKOUT_SHA",
                      "value": "{{workflow.parameters.GIT_CHECKOUT_SHA}}"
                    },
                    {
                      "name": "GIT_PUSH_REF",
                      "value": "{{workflow.parameters.GIT_PUSH_REF}}"
                    }
                  ]
                },
                "depends": "clone.Succeeded && previous-commit-sha.Succeeded"
              },
              {
                "name": "notification",
                "template": "notification",
                "arguments": {
                  "parameters": [
                    {
                      "name": "PREVIOUS_CHECKOUT_SHA",
                      "value": "{{workflow.outputs.parameters.PREVIOUS_CHECKOUT_SHA}}"
                    },
                    {
                      "name": "GIT_REPOSITORY_URL",
                      "value": "{{workflow.parameters.GIT_REPOSITORY_URL}}"
                    },
                    {
                      "name": "GIT_PUSH_REF",
                      "value": "{{workflow.parameters.GIT_PUSH_REF}}"
                    },
                    {
                      "name": "GIT_REPOSITORY_NAME",
                      "value": "{{workflow.parameters.GIT_REPOSITORY_NAME}}"
                    },
                    {
                      "name": "TRIGGER_WORKFLOWS_JOB_AUTHOR",
                      "value": "{{workflow.parameters.TRIGGER_WORKFLOWS_JOB_AUTHOR}}"
                    },
                    {
                      "name": "GIT_CHECKOUT_SHA",
                      "value": "{{workflow.parameters.GIT_CHECKOUT_SHA}}"
                    },
                    {
                      "name": "PROJECT_ID",
                      "value": "{{workflow.parameters.WORKFLOWS_API_PROJECT_ID}}"
                    },
                    {
                      "name": "NOTIFICATION_CARD_TEMPLATE_ID",
                      "value": "{{workflow.parameters.NOTIFICATION_CARD_TEMPLATE_ID}}"
                    },
                    {
                      "name": "NOTIFICATION_OPEN_CONVERSATION_ID",
                      "value": "{{workflow.parameters.NOTIFICATION_OPEN_CONVERSATION_ID}}"
                    },
                    {
                      "name": "NOTIFICATION_DINGTALK_BOT_ADDR",
                      "value": "{{workflow.parameters.NOTIFICATION_DINGTALK_BOT_ADDR}}"
                    },
                    {
                      "name": "CHANGE_LOG",
                      "value": "{{tasks.change-log.outputs.parameters.CHANGE_LOG}}"
                    },
                    {
                      "name": "CI_ENVIRONMENT_NAME",
                      "value": "{{tasks.change-log.outputs.parameters.CI_ENVIRONMENT_NAME}}"
                    }
                  ]
                },
                "depends": "clone.Succeeded && change-log.Succeeded"
              },
              {
                "name": "preflight",
                "template": "preflight",
                "arguments": {
                  "parameters": [
                    {
                      "name": "GIT_PUSH_REF",
                      "value": "{{workflow.parameters.GIT_PUSH_REF}}"
                    },
                    {
                      "name": "GIT_CHECKOUT_SHA",
                      "value": "{{workflow.parameters.GIT_CHECKOUT_SHA}}"
                    },
                    {
                      "name": "PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME",
                      "value": "{{workflow.parameters.PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}}"
                    },
                    {
                      "name": "GIT_BEFORE_SHA",
                      "value": "{{workflow.parameters.GIT_BEFORE_SHA}}"
                    },
                    {
                      "name": "PREVIOUS_CHECKOUT_SHA",
                      "value": "{{workflow.outputs.parameters.PREVIOUS_CHECKOUT_SHA}}"
                    },
                    {
                      "name": "_MANUAL_",
                      "value": "{{workflow.parameters._MANUAL_}}"
                    }
                  ]
                },
                "depends": "clone"
              },
              {
                "name": "build",
                "template": "build",
                "arguments": {
                  "artifacts": [
                    {
                      "name": "dependencies-list",
                      "from": "{{tasks.preflight.outputs.artifacts.dependencies-list}}"
                    }
                  ]
                },
                "depends": "preflight"
              },
              {
                "name": "result-to-json-list",
                "template": "result-to-json-list",
                "arguments": {
                  "artifacts": [
                    {
                      "name": "artifacts-list",
                      "from": "{{tasks.build.outputs.artifacts.artifacts-list}}"
                    }
                  ]
                },
                "depends": "build"
              },
              {
                "name": "docker-build",
                "template": "container",
                "arguments": {
                  "parameters": [
                    {
                      "name": "APPNAME",
                      "value": "{{item.appname}}"
                    },
                    {
                      "name": "CONTEXT_ROOT",
                      "value": "{{item.dir}}"
                    },
                    {
                      "name": "CI_REGISTRY_URL",
                      "value": "{{workflow.parameters.CI_REGISTRY_URL}}"
                    },
                    {
                      "name": "REGISTRY_CREDENTIAL_SECRET_NAME",
                      "value": "{{workflow.parameters.REGISTRY_CREDENTIAL_SECRET_NAME}}"
                    },
                    {
                      "name": "CI_COMMIT_SHORT_SHA",
                      "value": "{{workflow.outputs.parameters.CI_COMMIT_SHORT_SHA}}"
                    },
                    {
                      "name": "CONTAINER_PLATFORM",
                      "value": "linux/amd64"
                    }
                  ]
                },
                "withParam": "{{tasks.result-to-json-list.outputs.result}}",
                "depends": "result-to-json-list.Succeeded"
              },
              {
                "name": "sync-deploy",
                "template": "sync-deploy",
                "arguments": {
                  "parameters": [
                    {
                      "name": "GIT_DEPLOY_REPOSITORY_URL",
                      "value": "{{workflow.parameters.GIT_DEPLOY_REPOSITORY_URL}}"
                    },
                    {
                      "name": "aggregate-results",
                      "value": "{{tasks.docker-build.outputs.result}}"
                    },
                    {
                      "name": "GIT_DEPLOY_BRANCH_NAME",
                      "value": "{{workflow.parameters.GIT_DEPLOY_BRANCH_NAME}}"
                    }
                  ]
                },
                "depends": "docker-build.Succeeded"
              }
            ]
          }
        },
        {
          "name": "clone",
          "inputs": {
            "parameters": [
              {
                "name": "WORKFLOWS_API_DOMAIN"
              },
              {
                "name": "WORKFLOWS_API_NAMESPACE"
              },
              {
                "name": "WORKFLOWS_API_PROJECT_ID"
              },
              {
                "name": "WORKFLOWS_API_REPOSITORY"
              },
              {
                "name": "WORKFLOWS_API_BRANCH"
              },
              {
                "name": "GIT_REPOSITORY_URL"
              },
              {
                "name": "GIT_PUSH_REF",
                "value": "main"
              },
              {
                "name": "TRIGGER_ACCOUNT",
                "value": "user-01"
              },
              {
                "name": "GIT_CHECKOUT_SHA"
              },
              {
                "name": "GIT_REPOSITORY_NAME"
              },
              {
                "name": "OBJECT_KIND",
                "value": "push"
              },
              {
                "name": "PREVIOUS_CHECKOUT_SHA",
                "value": "/tmp/git/PREVIOUS_CHECKOUT_SHA"
              }
            ]
          },
          "outputs": {
            "parameters": [
              {
                "name": "CI_COMMIT_SHORT_SHA",
                "valueFrom": {
                  "path": "/tmp/CI_COMMIT_SHORT_SHA"
                },
                "globalName": "CI_COMMIT_SHORT_SHA"
              },
              {
                "name": "CI_COMMIT_MESSAGE",
                "valueFrom": {
                  "path": "/tmp/CI_COMMIT_MESSAGE"
                },
                "globalName": "CI_COMMIT_MESSAGE"
              }
            ]
          },
          "metadata": {},
          "container": {
            "name": "git",
            "image": "fcr.fawve.cluster.ws/bitnami/git@sha256:c01f7167dcd8d680a5bef264cc8213e1648e247ec739d6b15ee98ef5a1b0a467",
            "command": [
              "bash",
              "-euc"
            ],
            "args": [
              "## Login settings\ncase \"${GIT_CREDENTIAL_TYPE}\" in\n  SSH|ssh)\n    echo \"INFO: git clone method by [SSH]\"\n    (umask 077 ; echo \"${GIT_SSH_PRIVATEKEY}\" > /git_key)\n    git config --global core.sshCommand 'ssh -i /git_key -o StrictHostKeyChecking=false'\n  ;;\n  *)\n    # https://git-scm.com/docs/gitcredentials store password\n    echo \"INFO: git clone method by [HTTPS]\"\n    git config --global credential.\"{{inputs.parameters.GIT_REPOSITORY_URL}}\".username \"${GIT_USER}\"\n    git config --global credential.\"{{inputs.parameters.GIT_REPOSITORY_URL}}\".helper '!p(){ echo \"password=\"${GIT_PASSWORD}\"\";}; p'\n  ;;\nesac\necho \">_ git clone --branch ${GIT_PUSH_REF#refs/heads/} ${GIT_REPOSITORY_URL} --single-branch .\"\nrm -rf * && git clone --branch \"${GIT_PUSH_REF#refs/heads/}\" \"${GIT_REPOSITORY_URL}\" --single-branch .\ngit reset --hard {{inputs.parameters.GIT_CHECKOUT_SHA}}\n\n# get some parameters\ngit rev-parse --short HEAD > /tmp/CI_COMMIT_SHORT_SHA     # 当前分支短Commit_SHA\ngit log -1 --pretty=%B > /tmp/CI_COMMIT_MESSAGE           # 当前提交的 log message\n"
            ],
            "workingDir": "/workspace",
            "env": [
              {
                "name": "GIT_REPOSITORY_URL",
                "value": "{{inputs.parameters.GIT_REPOSITORY_URL}}"
              },
              {
                "name": "GIT_PUSH_REF",
                "value": "{{inputs.parameters.GIT_PUSH_REF}}"
              },
              {
                "name": "GIT_USER",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "git-repository-credential",
                    "key": "GIT_USER"
                  }
                }
              },
              {
                "name": "GIT_PASSWORD",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "git-repository-credential",
                    "key": "GIT_PASSWORD"
                  }
                }
              },
              {
                "name": "GIT_CREDENTIAL_TYPE",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "git-repository-credential",
                    "key": "GIT_CREDENTIAL_TYPE"
                  }
                }
              },
              {
                "name": "GIT_SSH_PRIVATEKEY",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "git-repository-credential",
                    "key": "GIT_SSH_PRIVATEKEY",
                    "optional": true
                  }
                }
              }
            ],
            "resources": {},
            "volumeMounts": [
              {
                "name": "workspace",
                "mountPath": "/workspace"
              }
            ]
          }
        },
        {
          "name": "get-previous-successful-commit-sha",
          "inputs": {
            "parameters": [
              {
                "name": "WORKFLOWS_API_DOMAIN"
              },
              {
                "name": "WORKFLOWS_API_NAMESPACE"
              },
              {
                "name": "WORKFLOWS_API_PROJECT_ID"
              },
              {
                "name": "WORKFLOWS_API_REPOSITORY"
              },
              {
                "name": "WORKFLOWS_API_BRANCH"
              },
              {
                "name": "PREVIOUS_CHECKOUT_SHA",
                "value": "/tmp/PREVIOUS_CHECKOUT_SHA"
              },
              {
                "name": "CURRENT_GIT_CHECKOUT_SHA",
                "description": "本次任务的 Commit SHA 值，用于判断是否重复执行任务"
              }
            ]
          },
          "outputs": {
            "parameters": [
              {
                "name": "PREVIOUS_CHECKOUT_SHA",
                "valueFrom": {
                  "path": "/tmp/PREVIOUS_CHECKOUT_SHA"
                },
                "globalName": "PREVIOUS_CHECKOUT_SHA"
              }
            ]
          },
          "metadata": {},
          "container": {
            "name": "workflow-previous-commit-sha",
            "image": "dellnoantechnp/git-yq:2.44",
            "command": [
              "bash",
              "-c"
            ],
            "args": [
              "echo \"INFO: Starting get last previous checkout sha by API [{{inputs.parameters.WORKFLOWS_API_DOMAIN}}] ....\"\ncurl -s --location \"https://{{inputs.parameters.WORKFLOWS_API_DOMAIN}}/api/v1/workflows/{{inputs.parameters.WORKFLOWS_API_NAMESPACE}}?\\\nlistOptions.labelSelector=\\\nproject_id={{inputs.parameters.WORKFLOWS_API_PROJECT_ID}},\\\nrepository={{inputs.parameters.WORKFLOWS_API_REPOSITORY}},\\\nbranch={{inputs.parameters.WORKFLOWS_API_BRANCH}}&\\\nfields=items.metadata.annotations,items.status.phase\" \\\n--header \"Authorization: Bearer $(cat /var/run/kubernetes/argo-workflows-token)\" | \\\njq -r 'limit(1; .items[] | select(.status.phase==\"Succeeded\") | select(.metadata.annotations.\"trigger.workflows.job/CHECKOUT_SHA\"!=\"{{inputs.parameters.CURRENT_GIT_CHECKOUT_SHA}}\")) | .metadata.annotations.\"'${ANNOTATION_CHECKOUT_SHA_NAME}'\"' | \\\ntee {{inputs.parameters.PREVIOUS_CHECKOUT_SHA}}\n\nif [[ -s {{inputs.parameters.PREVIOUS_CHECKOUT_SHA}} ]]; then\n  echo -e \"\\x1b[32mINFO\\x1b[0m: Finished to get last previous checkout sha by API.\"\nelse\n  echo \"0000000000000000000000000000000000000000\" > {{inputs.parameters.PREVIOUS_CHECKOUT_SHA}}\n  echo -e \"\\x1b[31mERROR\\x1b[0m: Failed to get last previous checkout sha by API, Set previous sha 0000000000000000000000000000000000000000\"\nfi\n"
            ],
            "workingDir": "/workspace",
            "env": [
              {
                "name": "ANNOTATION_CHECKOUT_SHA_NAME",
                "value": "trigger.workflows.job/CHECKOUT_SHA"
              }
            ],
            "resources": {},
            "volumeMounts": [
              {
                "name": "argo-workflows-operator-token",
                "mountPath": "/var/run/kubernetes/argo-workflows-token",
                "subPath": "token"
              }
            ]
          },
          "metrics": {
            "prometheus": [
              {
                "name": "ci_result_task_counter",
                "labels": [
                  {
                    "key": "stage",
                    "value": "clone"
                  },
                  {
                    "key": "branch",
                    "value": "{{ workflow.parameters.GIT_PUSH_REF }}"
                  },
                  {
                    "key": "status",
                    "value": "{{ status }}"
                  }
                ],
                "help": "Count of task execution by result status - task level",
                "counter": {
                  "value": "1"
                }
              }
            ]
          }
        },
        {
          "name": "change-log",
          "inputs": {
            "parameters": [
              {
                "name": "PREVIOUS_CHECKOUT_SHA",
                "value": "0000000000000000000000000000000000000000",
                "description": "上一次成功执行任务的SHA,默认值0000000000000000000000000000000000000000"
              },
              {
                "name": "GIT_CHECKOUT_SHA",
                "description": "本次触发任务的 SHA"
              },
              {
                "name": "GIT_PUSH_REF"
              }
            ]
          },
          "outputs": {
            "parameters": [
              {
                "name": "CHANGE_LOG",
                "valueFrom": {
                  "path": "/tmp/changelog.txt"
                },
                "globalName": "CHANGE_LOG",
                "description": "Git Change Log 内容"
              },
              {
                "name": "CI_ENVIRONMENT_NAME",
                "valueFrom": {
                  "path": "/tmp/CI_ENVIRONMENT_NAME.txt"
                },
                "globalName": "CI_ENVIRONMENT_NAME",
                "description": "发布环境名称"
              }
            ]
          },
          "metadata": {},
          "container": {
            "name": "commit-logs",
            "image": "fcr.fawve.cluster.ws/bitnami/git@sha256:c01f7167dcd8d680a5bef264cc8213e1648e247ec739d6b15ee98ef5a1b0a467",
            "command": [
              "bash",
              "-ec"
            ],
            "args": [
              "set -x\n## 开始处理分支与环境的对应关系\n## eg:\n##  >_ cat ${project-root:-.}/environment-mapping.txt\n##  # branch   environment\n##  master     beta\n##  production prod\nif [[ -f environment-mapping.txt ]]; then\n  echo \"INFO: 检测到 environment-mapping.txt 项目环境配置文件\"\n  CI_ENVIRONMENT_NAME=$(awk \"/^${GIT_PUSH_REF#refs/heads/}/{print \\$2}\" environment-mapping.txt)\nelse\n  echo \"INFO: 未检测到 environment-mapping.txt 项目环境配置文件，环境名称将默认采用 branch 名称.\"\n  CI_ENVIRONMENT_NAME=${GIT_PUSH_REF#refs/heads/}\nfi\necho \"${CI_ENVIRONMENT_NAME}\" > /tmp/CI_ENVIRONMENT_NAME.txt\n\nfunction get_change_log(){\n  if [[ \"${PREVIOUS_CHECKOUT_SHA}\" != \"0000000000000000000000000000000000000000\" ]]; then\n    echo \"From: ${PREVIOUS_CHECKOUT_SHA:0:8}..HEAD\"\n    git shortlog ${PREVIOUS_CHECKOUT_SHA}..HEAD --pretty=format:\"%h %s\" --no-merges --group=format:'- %an' -w76,4 | uniq\n  else\n    echo \"From: Last10..HEAD\"\n    git shortlog -10 HEAD --pretty=format:\"%h (%cr) %s\" --no-merges --group=format:'- %an' -w98,4 | uniq\n  fi\n}\nget_change_log | tee -a '/tmp/changelog.txt'\n"
            ],
            "workingDir": "/workspace",
            "env": [
              {
                "name": "PREVIOUS_CHECKOUT_SHA",
                "value": "{{inputs.parameters.PREVIOUS_CHECKOUT_SHA}}"
              },
              {
                "name": "GIT_CHECKOUT_SHA",
                "value": "{{inputs.parameters.GIT_CHECKOUT_SHA}}"
              },
              {
                "name": "GIT_PUSH_REF",
                "value": "{{inputs.parameters.GIT_PUSH_REF}}"
              }
            ],
            "resources": {},
            "volumeMounts": [
              {
                "name": "workspace",
                "mountPath": "/workspace"
              }
            ]
          }
        },
        {
          "name": "notification",
          "inputs": {
            "parameters": [
              {
                "name": "PREVIOUS_CHECKOUT_SHA",
                "value": "0000000000000000000000000000000000000000",
                "description": "上一次成功执行任务的SHA,默认值0000000000000000000000000000000000000000"
              },
              {
                "name": "GIT_CHECKOUT_SHA",
                "description": "本次触发任务的 SHA"
              },
              {
                "name": "GIT_REPOSITORY_URL"
              },
              {
                "name": "GIT_PUSH_REF"
              },
              {
                "name": "GIT_REPOSITORY_NAME"
              },
              {
                "name": "TRIGGER_WORKFLOWS_JOB_AUTHOR"
              },
              {
                "name": "NOTIFICATION_DINGTALK_BOT_ADDR",
                "value": "http://dingtalk-bot.workflows.svc:8000"
              },
              {
                "name": "PROJECT_ID",
                "description": "源码仓库项目的ID"
              },
              {
                "name": "NOTIFICATION_CARD_TEMPLATE_ID",
                "description": "互动卡片模板ID"
              },
              {
                "name": "NOTIFICATION_OPEN_CONVERSATION_ID",
                "description": "互动卡片投递群聊ID"
              },
              {
                "name": "CHANGE_LOG",
                "description": "Git Change Log"
              },
              {
                "name": "CI_ENVIRONMENT_NAME",
                "description": "发布环境名称"
              }
            ]
          },
          "outputs": {},
          "metadata": {},
          "container": {
            "name": "commit-logs",
            "image": "fcr.fawve.cluster.ws/bitnami/git@sha256:c01f7167dcd8d680a5bef264cc8213e1648e247ec739d6b15ee98ef5a1b0a467",
            "command": [
              "bash",
              "-ec"
            ],
            "args": [
              "set -x\nfunction post_notification(){\n  local job_url\n  ns=$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace)\n  job_name=${ARGO_NODE_ID%-*}\n  card_ref_link=\"https://workflows.fawve.jagat.io/workflows/${ns}/${job_name}\"\n  trigger_workflows_job_author=${TRIGGER_WORKFLOWS_JOB_AUTHOR}\n  environment_name=${CI_ENVIRONMENT_NAME}\n  curl -XPOST {{ inputs.parameters.NOTIFICATION_DINGTALK_BOT_ADDR }}/customRobot/test4 -H \"Content-Type: application/x-www-form-urlencoded\" \\\n    -H \"x-card-template-id: ${NOTIFICATION_CARD_TEMPLATE_ID}\" \\\n    -H \"x-open-conversation-id: ${NOTIFICATION_OPEN_CONVERSATION_ID}\" \\\n    --data-urlencode \"markdown_content={{ inputs.parameters.CHANGE_LOG }}\" \\\n    --data-urlencode \"card_ref_link=${card_ref_link}\" \\\n    --data-urlencode \"commit_sha=${GIT_CHECKOUT_SHA}\" \\\n    --data-urlencode \"task_name=${job_name}\" \\\n    --data-urlencode \"repository={{ inputs.parameters.GIT_REPOSITORY_NAME }}\" \\\n    --data-urlencode \"project_id={{ inputs.parameters.PROJECT_ID }}\" \\\n    --data-urlencode \"author=${TRIGGER_WORKFLOWS_JOB_AUTHOR}\" \\\n    --data-urlencode \"branch=${GIT_PUSH_REF#refs/heads/}\" \\\n    --data-urlencode \"environment={{ inputs.parameters.CI_ENVIRONMENT_NAME }}\" \\\n    --data-urlencode \"card_template_id=${NOTIFICATION_CARD_TEMPLATE_ID}\" \\\n    --data-urlencode \"open_conversation_id=${NOTIFICATION_OPEN_CONVERSATION_ID}\"\n  echo \"INFO: 通知发送成功.\"\n}\npost_notification\n\n# debug hook\nif [[ ${TRIGGER_WORKFLOWS_JOB_AUTHOR} == \"中文\" ]]; then\n  sleep 1800\nfi\n"
            ],
            "workingDir": "/workspace",
            "env": [
              {
                "name": "PREVIOUS_CHECKOUT_SHA",
                "value": "{{inputs.parameters.PREVIOUS_CHECKOUT_SHA}}"
              },
              {
                "name": "TRIGGER_WORKFLOWS_JOB_AUTHOR",
                "value": "{{inputs.parameters.TRIGGER_WORKFLOWS_JOB_AUTHOR}}"
              },
              {
                "name": "GIT_CHECKOUT_SHA",
                "value": "{{inputs.parameters.GIT_CHECKOUT_SHA}}"
              },
              {
                "name": "GIT_PUSH_REF",
                "value": "{{inputs.parameters.GIT_PUSH_REF}}"
              },
              {
                "name": "NOTIFICATION_CARD_TEMPLATE_ID",
                "value": "{{inputs.parameters.NOTIFICATION_CARD_TEMPLATE_ID}}"
              },
              {
                "name": "NOTIFICATION_OPEN_CONVERSATION_ID",
                "value": "{{inputs.parameters.NOTIFICATION_OPEN_CONVERSATION_ID}}"
              }
            ],
            "resources": {},
            "volumeMounts": [
              {
                "name": "workspace",
                "mountPath": "/workspace"
              }
            ]
          }
        },
        {
          "name": "preflight",
          "inputs": {
            "parameters": [
              {
                "name": "PREVIOUS_CHECKOUT_SHA",
                "value": "0000000000000000000000000000000000000000",
                "description": "上一次成功执行任务的SHA,默认值0000000000000000000000000000000000000000"
              },
              {
                "name": "GIT_PUSH_REF"
              },
              {
                "name": "GIT_CHECKOUT_SHA"
              },
              {
                "name": "GIT_BEFORE_SHA"
              },
              {
                "name": "PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME",
                "value": "{{workflow.parameters.PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}}"
              },
              {
                "name": "MAVEN_LOCAL_REPO_DIR",
                "value": "/workspace/repository"
              },
              {
                "name": "CI_ENVIRONMENT_NAME",
                "value": "{{workflow.parameters.CI_ENVIRONMENT_NAME}}"
              },
              {
                "name": "MAVEN_OPTS",
                "value": "-Dhttps.protocols=TLSv1.2 -Dmaven.repo.local=$(MAVEN_LOCAL_REPO_DIR) -Dorg.slf4j.simpleLogger.showDateTime=false -Djava.awt.headless=true"
              },
              {
                "name": "MAVEN_CLI_OPTS",
                "value": "--batch-mode --no-transfer-progress --threads=1 --settings /workspace/settings.xml -Dmaven.test.skip=true -P k8s --fail-at-end -X"
              },
              {
                "name": "_MANUAL_",
                "value": "false"
              }
            ]
          },
          "outputs": {
            "parameters": [
              {
                "name": "CI_ENVIRONMENT_NAME",
                "valueFrom": {
                  "path": "/tmp/CI_ENVIRONMENT_NAME"
                },
                "globalName": "CI_ENVIRONMENT_NAME"
              }
            ],
            "artifacts": [
              {
                "name": "dependencies-list",
                "path": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
              }
            ]
          },
          "metadata": {},
          "container": {
            "name": "",
            "image": "fcr.fawve.cluster.ws/maven:3.9-eclipse-tumurin-17",
            "command": [
              "bash",
              "-c"
            ],
            "args": [
              "# 日志函数\nlog_info() { echo \"[INFO] $1\"; }\nlog_error() { echo \"[ERROR] $1\" >&2; }\nlog_debug() { [[ \"${CI_DEBUG_TRACE:-false}\" == \"true\" ]] && echo \"[DEBUG] $1\"; }\n\n# Debug Mode\nif [[ ${CI_DEBUG_TRACE} == true ]]; then set -x; fi\nif [[ \"${_MANUAL_}\" == true ]]; then echo \"INFO:\\ 手动触发作业!\"; fi\necho \"INFO: 查找需要编译发布的模块列表 ....\"\necho \"INFO: GIT_CHECKOUT_SHA:{{inputs.parameters.GIT_CHECKOUT_SHA}} \n      GIT_BEFORE_SHA:{{inputs.parameters.GIT_BEFORE_SHA}}\"\necho -e \"${CI_COMMIT_MESSAGE}\\n\\n\"\n\n# 适配多版本 jdk 编译需求\nJDK_VERSION_MAJOR=$(java --version &> /dev/stdout | grep -Po '(?<=openjdk ).*?(?=\\.)')\nMAVEN_LOCAL_REPO_DIR=${MAVEN_LOCAL_REPO_DIR}/repository-${JDK_VERSION_MAJOR}\necho \"INFO: Maven local repository dir -> ${MAVEN_LOCAL_REPO_DIR}\"\n\nif [[ \"{{inputs.parameters.PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}}\" ]]; then\n  echo \"INFO: 获取到预定义 PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME 为 {{inputs.parameters.PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}}\"\nelse\n  echo -e \"INFO: 开始自动获取 Project Dependency Group Name \\x1b[;5m....\\x1b[0m\"\n  mvn -Dmaven.test.skip=true --batch-mode --no-transfer-progress --settings /workspace/settings.xml --fail-at-end -X verify | tee /tmp/verify_out.log\n  grep -Po '(?<=< ).*(?= >)' /tmp/verify_out.log > /tmp/group.log\n  PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME=$(cat /tmp/group.log | awk -F: '{print $1}' | sort | uniq | paste -sd,)\n  echo -e \"INFO: 获取到当前 PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME 为 \\x1b[32m${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}\\x1b[0m\"\nfi\n\n## 开始处理分支与环境的对应关系\n## eg:\n##  >_ cat ${project-root:-.}/environment-mapping.txt\n##  # branch   environment\n##  master     beta\n##  production prod\nif [[ -f environment-mapping.txt ]]; then\n  echo \"INFO: 检测到 environment-mapping.txt 项目环境配置文件\"\n  CI_ENVIRONMENT_NAME=$(awk \"/^${GIT_PUSH_REF#refs/heads/}/{print \\$2}\" environment-mapping.txt)\nelse\n  echo \"INFO: 未检测到 environment-mapping.txt 项目环境配置文件，环境名称将默认采用 branch 名称.\"\n  CI_ENVIRONMENT_NAME=${GIT_PUSH_REF#refs/heads/}\nfi\necho ${CI_ENVIRONMENT_NAME} > /tmp/CI_ENVIRONMENT_NAME\necho \"INFO: 环境名称 ${CI_ENVIRONMENT_NAME}\"\n\n# 获取 monorepo 项目的子父模块依赖关系\necho \"INFO: 获取 monorepo 项目的模块依赖关系\"\nmvn ${MAVEN_CLI_OPTS} dependency:tree -Dincludes=\"${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}\" | tee \"${MVN_LOG_FILE}\"\nPROJECT_DEPENDENCY_INCLUDE_GROUP_NAME_ON_SHELL=$(echo ${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME} | sed 's/,/\\|/g')\necho \"DEBUG: PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME_ON_SHELL value is ${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME_ON_SHELL}\"\n\ncat \"${MVN_LOG_FILE}\" | sed -En '/^\\[INFO\\]\\s'${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME_ON_SHELL}':.*:jar:/,/^\\[INFO\\]\\s?[-]*$/p' | \\\n  grep -E '^\\[INFO\\]' | \\\n  sed -E 's/^\\[INFO\\]\\s-+$/\\[INFO\\] /' \\\n  > ${PROJECT_DEPENDENCY_TREE_FILE}\nif [[ $(cat ${PROJECT_DEPENDENCY_TREE_FILE} | wc -l) -gt 1 ]]; then\n  echo \"DEBUG: PROJECT_DEPENDENCY_TREE_FILE 文件 ${PROJECT_DEPENDENCY_TREE_FILE} 结果如下\"\n  cat ${PROJECT_DEPENDENCY_TREE_FILE}\nelse\n  echo \"ERROR: PROJECT_DEPENDENCY_TREE_FILE 文件 ${PROJECT_DEPENDENCY_TREE_FILE} 为空行.\"\n  exit 1\nfi\n\n# 获取 Maven 反应堆输出的模块 pom.xml 文件路径与module对应关系\nREACTOR_PROJECT_MAPPING_FILE=reactorProject_mapping.txt\n# [TODO] 检查 \"${MVN_LOG_FILE}\" 文件是否正常\n# 注意：maven-dependency-plugin 插件版本在 3.7.x 及以上版本中，DEBUG 输出中不再包含 \n# \"project = MavenProject: io.jagat:notify-server:2.1.0-SNAPSHOT @ D:\\IDEA-Projects\\utown\\notify-server\\pom.xml\" 信息，\n# 会导致无法产生 reactorProject 与 pom.xml 的对应关系.\ncat \"${MVN_LOG_FILE}\" | sed -En '/\\[DEBUG\\]\\s+\\(f\\)\\sproject\\s=\\sMavenProject:/p' > \"${REACTOR_PROJECT_MAPPING_FILE}\"\nif [[ \"$(stat -c %s ${REACTOR_PROJECT_MAPPING_FILE})\" -le 1 ]]; then\n  echo \"ERROR: REACTOR_PROJECT_MAPPING_FILE 文件 ${REACTOR_PROJECT_MAPPING_FILE} 大小为空，无法获取 reactorProject 与 pom.xml 文件的对应关系.\"\n  rm -rf ${REACTOR_PROJECT_MAPPING_FILE}\nfi\n\n# 检查输入文件是否存在\nif [ ! -f \"${PROJECT_DEPENDENCY_TREE_FILE}\" ] || [ ! -f \"${REACTOR_PROJECT_MAPPING_FILE}\" ]; then\n  echo \"错误：缺少必要的依赖关系文件\"\n  exit 1\nfi\n\nARTIFACT_INDICATORS=(\"Dockerfile.${CI_ENVIRONMENT_NAME}\" \"run.sh\" \"env.sh\")      # 用于识别需要构建制品的模块的标志文件\n\n# 声明关联数组\ndeclare -A MODULE_PATHS      # 存储模块的路径\ndeclare -A DEPENDENCIES      # 存储模块的依赖关系\ndeclare -A AFFECTED_MODULES  # 存储受影响的模块\ndeclare -A ARTIFACT_MODULES  # 存储需要构建制品的模块\n\n# 检查目录是否包含制品标志文件\nis_artifact_module() {\n  local module_path=\"$1\"\n  for indicator in \"${ARTIFACT_INDICATORS[@]}\"; do\n    if [[ -f \"${module_path}/${indicator}\" ]]; then\n      return 0\n    fi\n  done\n  return 1\n}\n\n# 解析模块路径\nparse_module_paths() {\n  while IFS= read -r line; do\n  if [[ $line =~ MavenProject:\\ ([^:]+):([^:]+):([^\\ @]+)\\ @\\ (/.+)pom.xml ]]; then\n    local group_id=\"${BASH_REMATCH[1]}\"\n    local artifact_id=\"${BASH_REMATCH[2]}\"\n    local version=\"${BASH_REMATCH[3]}\"\n    local path=\"${BASH_REMATCH[4]}\"\n    local module_key=\"${group_id}:${artifact_id}:${version}\"\n    path=${path#$PWD/}\n    [[ $path == \"\" ]] && continue     # 忽略顶级pom.xml\n\n    MODULE_PATHS[\"$module_key\"]=\"$path\"\n\n    # 检查是否为制品模块\n    if is_artifact_module \"$path\"; then\n        ARTIFACT_MODULES[\"$module_key\"]=1\n        log_debug \"发现制品模块: $module_key at $path\"\n    fi\n  fi\n  done < \"${REACTOR_PROJECT_MAPPING_FILE}\"\n}\n\n# 解析依赖关系\nparse_dependencies() {\n  local current_module=\"\"\n  while IFS= read -r line; do\n    # 检测模块声明行\n    if [[ $line =~ \\[INFO\\]\\ ([^:\\\\+|]+):([^:]+):(jar|pom):([^\\ ]+) ]]; then\n      current_module=\"${BASH_REMATCH[1]}:${BASH_REMATCH[2]}:${BASH_REMATCH[4]}\"\n      DEPENDENCIES[\"$current_module\"]=\"\"\n    # 检测依赖行\n    elif [[ $line =~ \\[INFO\\]\\ [+\\\\|-]+-\\ ([^:]+):([^:]+):jar:([^:]+) ]] && [ ! -z \"$current_module\" ]; then\n      local dep=\"${BASH_REMATCH[1]}:${BASH_REMATCH[2]}:${BASH_REMATCH[3]}\"\n      DEPENDENCIES[\"$current_module\"]+=\"$dep \"\n    fi\n  done < \"${PROJECT_DEPENDENCY_TREE_FILE}\"\n}\n\n# 递归查找依赖此模块的所有模块\nfind_dependent_modules() {\n  local target_module=\"$1\"\n  for module in \"${!DEPENDENCIES[@]}\"; do\n    local deps=\"${DEPENDENCIES[$module]}\"\n    if [[ $deps =~ $target_module ]]; then\n      AFFECTED_MODULES[\"$module\"]=1\n      find_dependent_modules \"$module\"\n  fi\n  done\n}\n\n# 检查变更的目录并确定受影响的模块\ncheck_changes() {\n  local changed_path=\"$1\"\n  # 查找变更路径对应的模块\n  for module in \"${!MODULE_PATHS[@]}\"; do\n    local path=\"${MODULE_PATHS[$module]}\"\n    if [[ \"$changed_path\" == \"$path\"* ]]; then\n      AFFECTED_MODULES[\"$module\"]=1\n      find_dependent_modules \"$module\"\n    break\n  fi\n  done\n}\n\n# 输出结果\nprint_results() {\n  for module in \"${!ARTIFACT_MODULES[@]}\"; do\n    echo \"  - $module (${MODULE_PATHS[$module]})\"\n  done\n\n  log_info \"需要重新构建的模块:\"\n  local found_artifact=false\n  for module in \"${!AFFECTED_MODULES[@]}\"; do\n    if [[ -n \"${ARTIFACT_MODULES[$module]}\" ]]; then\n      echo \"  - $module (${MODULE_PATHS[$module]})\"\n      found_artifact=true\n    fi\n  done\n  [[ \"$found_artifact\" == \"false\" ]] && echo \"  没有需要重建的制品模块\"\n}\nparse_module_paths\nparse_dependencies\n\n## tools functions\nfunction get_pom_path_by_artifactId(){\n  local artifact_id\n  if [[ -z $1 ]]; then\n    return\n  else\n    artifact_id=\"$1\"\n  fi\n  awk -F'@ ' -v pwd=\"$PWD/\" -v artifact=$artifact_id '$0 ~ artifact{gsub(pwd, \"\", $2);print $2}' \"${REACTOR_PROJECT_MAPPING_FILE}\"\n}\nfunction get_artifactId_by_pom_path(){\n  # 根据 pom 路径获取子模块的 artifactId\n  local pom_path\n  if [[ -z $1 ]]; then\n    return\n  else\n    pom_path=\"$1\"\n  fi\n  awk -v pom=$pom_path '$0 ~ pom{print $6}' \"${REACTOR_PROJECT_MAPPING_FILE}\" | awk -F: '{print $1\":\"$2\":\"}'\n}\n\n### 在 dependency:tree 日志中过滤项目模块依赖关系, 逻辑待定\n#while read -r line; do\n#  C_NAME=$(echo $line | grep -cP '(?<=^\\[INFO\\]\\ '${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}':).*(?=:jar:.*$)')\n#  if [[ $C_NAME -eq 1 ]]; then\n#    # 取出首行模块名称，模块的依赖不会被匹配，所以 app_artifact_id 在一个依赖树中不会被覆盖\n#    app_artifact_id=$(echo $line | grep -oP '(?<=^\\[INFO\\]\\ )'${PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME}':.*:(?=jar:.*$)')\n#  fi\n#  C_END=$(echo $line | grep -Ec '^\\[INFO\\]\\ ?$')\n#  if [[ $C_END -ne 0 ]]; then\n#    ## 进入结尾步骤\n#    mv /tmp/temp.txt /tmp/split_${app_artifact_id}.txt\n#  else\n#    ## 继续向下匹配\n#    if [[ x${CI_DEBUG_TRACE} == \"xtrue\" ]]; then echo \"DEBUG: 继续遍历 ${app_artifact_id} 的依赖包\"; fi\n#    echo $line >> /tmp/temp.txt\n#  fi\n#done < ${PROJECT_DEPENDENCY_TREE_FILE}\n#\n#if [[ x${CI_DEBUG_TRACE} == \"xtrue\" ]]; then ls -lh /tmp/split_*.txt; fi\n\n## 根据 tag 和分支的上一次成功流水线，对比与当前commit的提交记录变更，获取变更文件列表\nif [[ $CI_COMMIT_TAG != \"\" ]]; then\n  ## tag 创建的时候，GIT_BEFORE_SHA 始终为 000...000，因此需要检测是否有上一次 tag 提交\n  while read -r line; do \n    # 取上一次 tag 名称\n    echo $line\n    if [[ $line != ${CI_COMMIT_TAG} ]]; then \n      LAST_TAG=$line \n    fi\n  done < <(git tag --sort=-v:refname | grep -A 1 ${CI_COMMIT_TAG})\n  if [[ $LAST_TAG != \"\" ]]; then\n  # 根据上一次tag名称取上一次tag的commit id\n    GIT_BEFORE_SHA=$(git rev-list -n 1 ${LAST_TAG})\n  else\n  # 否则进行全量发布\n    _MANUAL_=true\n  fi\nelse\n  echo \"INFO: 取上一次 ${GIT_PUSH_REF} 分支流水线成功的 commitID\"\n  ## Gitlab API\n  #PREVIOUS_HASH=$(curl -s -H \"PRIVATE-TOKEN:${GITLAB_TOKEN}\" \"${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/pipelines?ref=${GIT_PUSH_REF}&status=success&per_page=1\")\n  ## Argo-Workflows\n  PREVIOUS_HASH={{inputs.parameters.PREVIOUS_CHECKOUT_SHA}}\n  C=$(echo ${PREVIOUS_HASH} | grep -cE '[0-9a-f]{40}') || true    ## return: 1 or 0\n  if [[ $C -eq 1 ]]; then\n    PREV_HASH=$(echo ${PREVIOUS_HASH} | grep -oE '[0-9a-f]{40}')\n    echo \"INFO: 从 CI 流水线历史中发现上次成功执行流水线的CommitID为 [${PREV_HASH}]\"\n    is_Commit_EXISTS=$(git cat-file -t ${PREV_HASH})   ## output: \"commit\"\n    if [[ ${is_Commit_EXISTS} == \"commit\" ]]; then\n      echo \"DEBUG: 从本地Git库中检测到 [${PREV_HASH}] 的存在\"\n      GIT_BEFORE_SHA=\"${PREV_HASH}\"\n    else\n      echo \"WARN: 从本地库中未检测到 [${PREV_HASH}] 的存在，执行保底策略，从本地rev-list的初始提交开始拉取变更....\"\n      GIT_BEFORE_SHA=$(git rev-list --max-parents=0 HEAD)\n      echo \"INFO: 初始CommitID为 [$GIT_BEFORE_SHA]\"\n    fi\n  else\n    echo \"WARN: 未探测到上次成功执行的流水线，开始执行全量编译.\"\n    _MANUAL_=true\n  fi\nfi\n\n> ${MAVEN_BUILD_PROJECT_DIR_FILE}      # 初始化空文件\n\n## 当触发合并提交时，Gitlab CI_COMMIT_BEFORE_SHA 值为 000000，此时需要重新获取上一次本分支提交的 Commit ID\necho \"INFO: 进入本地提交变更检测阶段，检测项目顶级 pom.xml 是否变更，对比 $GIT_CHECKOUT_SHA --> $GIT_BEFORE_SHA 的提交变更...\"\nfor dir in $(git diff --name-only $GIT_CHECKOUT_SHA $GIT_BEFORE_SHA | awk -F'(/src/|/Dockerfile.'${CI_ENVIRONMENT_NAME}'|/pom.xml|/env.sh|/run.sh$)' '{print $1}' | sort -u); do \n    if [[ \"${dir}\" == \"pom.xml\" ]]; then \n      echo \"INFO: 检测到顶级 pom.xml 发生变更，开始执行全量编译.\"\n      _MANUAL_=true\n    fi\ndone\n\n## 全量发布逻辑\nif [[ \"$_MANUAL_\" == \"true\" ]]; then\n  ## 手动触发流水线埋入变量 _MANUAL_  值置为 true 即为触发全量发布\n  if [[ x$CI_DEBUG_TRACE == \"xtrue\" ]]; then ls -lh; fi\n  echo \"INFO: 检测到全量发布新分支.\"\n  echo \"INFO: 将要全量编译的模块...\"\n  ## 获取所有模块列表，${MAVEN_BUILD_PROJECT_DIR_FILE} 文件内容为 --> 模块group:artifact:名称   pom_dir\n  grep -oP '(?<=\\[INFO\\]\\s)[a-z].*$' ${PROJECT_DEPENDENCY_TREE_FILE} > /tmp/all_modules.txt\n  while read -r line; do\n    module=$(echo $line | awk -F: '{print $1\":\"$2\":\"}')\n    pom_dir=$(dirname $(get_pom_path_by_artifactId \"$module\"))\n    if [[ -f ${pom_dir}/Dockerfile.${CI_ENVIRONMENT_NAME} ]]; then\n      printf \"%10s 模块:\\x1b[32m%30s\\x1b[0m 目录位于:%-50s\\n\"  \"$Indent\" \"[${module}]\" \"${pom_dir}\"\n      echo \"${module}\" \"${pom_dir}\" >> ${MAVEN_BUILD_PROJECT_DIR_FILE}\n    else\n      printf \"\\x1b[90m%10s 模块:%30s 无需发布, %s\\x1b[0m\\n\" \"$Indent\" \"[${module}]\" \"未找到${pom_dir}/Dockerfile.${CI_ENVIRONMENT_NAME}文件.\"\n    fi\n  done < /tmp/all_modules.txt\nelif [[ \"$_MANUAL_\" != \"true\" ]]; then\n  # 进入探测 Git 变更部分编译阶段\n  if [[ \"${CI_COMMIT_BEFORE_SHA}\" == \"0000000000000000000000000000000000000000\" ]]; then \n    echo \"INFO: 执行最近上一次提交的变更探测...\"\n    CI_COMMIT_BEFORE_SHA=$(git rev-parse HEAD~1)\n  fi\n  ## 当触发合并提交时，Gitlab CI_COMMIT_BEFORE_SHA 值为 000000，此时需要重新获取上一次本分支提交的 Commit ID\n  echo \"INFO: 进入本地提交变更检测阶段，对比 $GIT_CHECKOUT_SHA --> $GIT_BEFORE_SHA 的提交变更...\"\n  echo \"INFO: command [git diff --name-only $GIT_CHECKOUT_SHA $GIT_BEFORE_SHA]\"\n  for dir in $(git diff --name-only $GIT_CHECKOUT_SHA $GIT_BEFORE_SHA | awk -F'(/src/|/Dockerfile.'${CI_ENVIRONMENT_NAME}'|/pom.xml|/env.sh|/run.sh$)' '{print $1}' | sort -u); do \n    if [[ ! -d ${dir} ]]; then \n      ## 如果不是目录，则跳过\n      continue\n    fi\n    if [[ ! -f ${dir}/Dockerfile.${CI_ENVIRONMENT_NAME} ]]; then\n      check_changes \"${dir}/\"\n      for module in \"${!AFFECTED_MODULES[@]}\"; do\n        if [[ -n \"${ARTIFACT_MODULES[$module]}\" ]]; then\n          echo \"INFO: 探测到依赖变更，需要打包的Maven模块 [${module}] 目录位于 ${MODULE_PATHS[$module]}\"\n          if grep -q \"${MODULE_PATHS[$module]}\" ${MAVEN_BUILD_PROJECT_DIR_FILE}; then\n            echo \"INFO: 已存在${module},跳过本轮探测..\"\n          else\n            echo \"$module ${MODULE_PATHS[$module]}\" >> \"$MAVEN_BUILD_PROJECT_DIR_FILE\"\n            found_artifact=true\n          fi\n        fi\n      done\n    #  ## 如果没有 Dockerfile，可能为依赖模块，走依赖判定流程\n    #  # 查找所有具有依赖关系的模块名称\n    #  artifact=$(get_artifactId_by_pom_path ${dir})\n    #  ARTIFACTID_IDs=$(grep \"${artifact}\" /tmp/split_*.txt | grep -oP '(?<=split_).*(?=.txt)') || true\n    #  if [[ ${ARTIFACTID_IDs} != \"\" ]]; then\n    #    for module in ${ARTIFACTID_IDs}; do\n    #      pom_dir=$(dirname $(get_pom_path_by_artifactId ${module}))\n    #      if [[ -f ${pom_dir}/Dockerfile.${CI_ENVIRONMENT_NAME} ]]; then\n    #        is_module_dir_exists=$(cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | grep -c ${pom_dir}) || true  ## Count\n    #        if [[ ${is_module_dir_exists} -lt 1 ]]; then\n    #          echo \"INFO: 探测到依赖变更，需要打包的Maven模块 [${module}] 目录位于 ${pom_dir}\"\n    #          echo \"${module}\" \"${pom_dir}\" >> ${MAVEN_BUILD_PROJECT_DIR_FILE}\n    #        fi\n    #      fi\n    #    done\n    #  fi\n      ## 进行下一轮探测,跳出本轮循环\n      continue\n    fi\n    module=$(get_artifactId_by_pom_path ${dir})   # 获取模块的 artifact 名称\n    if [[ $(grep -c $module $MAVEN_BUILD_PROJECT_DIR_FILE) -lt 1 ]]; then\n      echo \"INFO: 将要编译打包模块 [${module%:}] 目录位于 ${dir}/ ...\"\n      if grep -q \"${dir}/\" ${MAVEN_BUILD_PROJECT_DIR_FILE}; then\n        echo \"INFO: 已存在${dir}/,跳过本轮探测..\"\n      else\n        echo \"${module}\" \"${dir}/\" >> $MAVEN_BUILD_PROJECT_DIR_FILE\n      fi\n    fi\n  done\nfi\nif [[ $(cat $MAVEN_BUILD_PROJECT_DIR_FILE | wc -l) -ge 1 ]]; then\n  echo \"INFO: ↓↓↓↓↓↓ 需要编译的模块列表 ↓↓↓↓↓↓\"\n  cat $MAVEN_BUILD_PROJECT_DIR_FILE\n  echo \"INFO: 请稍后确认 CI 流程maven编译阶段是否成功运行\"\nelse\n  echo -e \"\\e[33;5mWARN:\\e[0m 未找到需要编译的模块列表，请确认 commit:$GIT_CHECKOUT_SHA 的代码变更在流水线检测范围内。\"\n  false\nfi\n"
            ],
            "workingDir": "/workspace",
            "env": [
              {
                "name": "GIT_PUSH_REF",
                "value": "{{inputs.parameters.GIT_PUSH_REF}}"
              },
              {
                "name": "GIT_CHECKOUT_SHA",
                "value": "{{inputs.parameters.GIT_CHECKOUT_SHA}}"
              },
              {
                "name": "MAVEN_LOCAL_REPO_DIR",
                "value": "{{inputs.parameters.MAVEN_LOCAL_REPO_DIR}}"
              },
              {
                "name": "MAVEN_OPTS",
                "value": "{{inputs.parameters.MAVEN_OPTS}}"
              },
              {
                "name": "MAVEN_CLI_OPTS",
                "value": "{{inputs.parameters.MAVEN_CLI_OPTS}}"
              },
              {
                "name": "MAVEN_BUILD_PROJECT_DIR_FILE",
                "value": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
              },
              {
                "name": "PROJECT_DEPENDENCY_TREE_FILE",
                "value": "dependencies.txt"
              },
              {
                "name": "CI_ENVIRONMENT_NAME",
                "value": "{{inputs.parameters.CI_ENVIRONMENT_NAME}}"
              },
              {
                "name": "CI_DEBUG_TRACE",
                "value": "{{workflow.parameters.CI_DEBUG_TRACE}}"
              },
              {
                "name": "MVN_LOG_FILE",
                "value": "mvn.log"
              },
              {
                "name": "_MANUAL_",
                "value": "{{inputs.parameters._MANUAL_}}"
              }
            ],
            "resources": {},
            "volumeMounts": [
              {
                "name": "workspace",
                "mountPath": "/workspace"
              },
              {
                "name": "maven-settings",
                "mountPath": "/workspace/settings.xml",
                "subPath": "settings.xml"
              },
              {
                "name": "maven-repository-cache",
                "mountPath": "/workspace/repository"
              }
            ]
          }
        },
        {
          "name": "build",
          "inputs": {
            "parameters": [
              {
                "name": "MAVEN_LOCAL_REPO_DIR",
                "value": "/workspace/repository"
              },
              {
                "name": "MAVEN_OPTS",
                "value": "-Dhttps.protocols=TLSv1.2 -Dmaven.repo.local=$(MAVEN_LOCAL_REPO_DIR) -Dorg.slf4j.simpleLogger.showDateTime=true -Djava.awt.headless=true"
              },
              {
                "name": "MAVEN_CLI_OPTS",
                "value": "--batch-mode --errors --fail-at-end --show-version --no-transfer-progress --threads=4 --settings /workspace/settings.xml -DinstallAtEnd=true -DdeployAtEnd=true -Dmaven.test.skip=true -P k8s"
              }
            ],
            "artifacts": [
              {
                "name": "dependencies-list",
                "path": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
              }
            ]
          },
          "outputs": {
            "artifacts": [
              {
                "name": "artifacts-list",
                "path": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
              }
            ]
          },
          "metadata": {},
          "script": {
            "name": "maven-build",
            "image": "fcr.fawve.cluster.ws/maven:3.9-eclipse-tumurin-17",
            "command": [
              "bash",
              "-e"
            ],
            "workingDir": "/workspace",
            "env": [
              {
                "name": "_MANUAL_",
                "value": "{{workflow.parameters._MANUAL_}}"
              },
              {
                "name": "MAVEN_LOCAL_REPO_DIR",
                "value": "{{inputs.parameters.MAVEN_LOCAL_REPO_DIR}}"
              },
              {
                "name": "MAVEN_BUILD_PROJECT_DIR_FILE",
                "value": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
              },
              {
                "name": "MAVEN_OPTS",
                "value": "{{inputs.parameters.MAVEN_OPTS}}"
              },
              {
                "name": "MAVEN_CLI_OPTS",
                "value": "{{inputs.parameters.MAVEN_CLI_OPTS}}"
              },
              {
                "name": "CI_DEBUG_TRACE",
                "value": "{{workflow.parameters.CI_DEBUG_TRACE}}"
              }
            ],
            "resources": {},
            "volumeMounts": [
              {
                "name": "workspace",
                "mountPath": "/workspace"
              },
              {
                "name": "maven-settings",
                "mountPath": "/workspace/settings.xml",
                "subPath": "settings.xml"
              },
              {
                "name": "maven-repository-cache",
                "mountPath": "/workspace/repository"
              }
            ],
            "source": "# Debug Mode\nif [[ ${CI_DEBUG_TRACE} == true ]]; then set -x; fi\n\n# 适配多版本 jdk 编译需求\nJDK_VERSION_MAJOR=$(java --version &> /dev/stdout | grep -Po '(?<=openjdk ).*?(?=\\.)')\nMAVEN_LOCAL_REPO_DIR=${MAVEN_LOCAL_REPO_DIR}/repository-${JDK_VERSION_MAJOR}\necho \"INFO: Maven local repository dir -> ${MAVEN_LOCAL_REPO_DIR}\"\n\necho \"↓↓↓↓↓↓↓↓↓↓↓↓↓↓  maven:开始编译jar包 ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓\"\necho \">_ mvn ${MAVEN_CLI_OPTS} clean package -U -pl $(cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | awk '{print $2}' | tr \"\\n\" \",\") -am\"\nmvn ${MAVEN_CLI_OPTS} clean package -U -pl $(cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | awk '{print $2}' | tr \"\\n\" \",\") -am\necho \"↑↑↑↑↑↑↑↑↑↑↑↑  maven:编译完成  ↑↑↑↑↑↑↑↑↑↑↑↑↑↑\"\n\necho \"INFO: 查找需要进入流水线打包的物料...\"\nLINE_COUNT=$(cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | wc -l)\nif [[ -s ${MAVEN_BUILD_PROJECT_DIR_FILE} ]]; then\n  for line in $(cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | awk '{print $2}'); do\n    find . -path \"./.m2\" -prune -o -path \"${line%/}/target/*.jar\" -print\n  done\nfi\necho \"INFO: 查找物料结束.\"\n\nwhile read -r line; do\n  module_path=$(echo $line | awk '{print $2}')\n\n  jar_path=$(find $module_path -path \"*/target/*\" -name \"*.jar\")\n  line_number=$(grep -n \"${module_path}\" ${MAVEN_BUILD_PROJECT_DIR_FILE} | awk -F: '{print $1}')\n  ## 字段： maven模块名称     模块在project的相对路径    jar包文件在project的相对路径\n  sed -i \"${line_number}s&$&\\ ${jar_path}&\" ${MAVEN_BUILD_PROJECT_DIR_FILE}\n\n  ## 在字段中最后一个字段添加app_name名称 (命名规则:只能包含小写字母、数字，以及 '-' 和 '.')\n  if [[ -f ${module_path%/}/.appname ]]; then\n    # 取首行为模块名称，转换为小写字符\n    appname=$(head -1 ${module_path%/}/.appname | tr '[:upper:]' '[:lower:]')\n    echo \"INFO: 检测到模块路径 [${module_path%/}/.appname] 中存在模块名定义   appname -> ${appname#*/}\"\n  else\n    # 取项目目录的名称作为模块名\n    appname=$(echo ${module_path%/} | tr '[:upper:]' '[:lower:]')\n    echo \"INFO: 未指定模块名称，使用 [./${module_path%/}] 作为模块名      appname -> ${appname#*/}\"\n  fi\n  sed -i \"${line_number}s&$&\\ ${appname#*/}&\" ${MAVEN_BUILD_PROJECT_DIR_FILE}\ndone < ${MAVEN_BUILD_PROJECT_DIR_FILE}\ncat ${MAVEN_BUILD_PROJECT_DIR_FILE}\n\n#for module in $(cat ${MAVEN_BUILD_PROJECT_DIR_FILE}); do\n#  ## 构造 grep -e 命令行参数\n#  NEED_RECEIVE_JAR=\"${NEED_RECEIVE_JAR} -e $module\"\n#done\n#for file in $(find . -path \"*/target/*\" -name \"*.jar\"); do\n#    CODE=$(echo $file | grep -c ${NEED_RECEIVE_JAR}) || true\n#    if [[ $CODE -eq 0 ]]; then   ## 如果不需要保留制品\n#      echo \"INFO: 清理无用的依赖包 $file ...\" && rm -rf $file\n#    else\n#      continue\n#    fi\n#done\n#echo \"INFO: 清理任务完成，输出需要进入流水线的制品物料包\"\n#find . -path \"./.m2\" -prune -o -path \"*/target/*.jar\" -print); do\n"
          }
        },
        {
          "name": "result-to-json-list",
          "inputs": {
            "artifacts": [
              {
                "name": "artifacts-list",
                "path": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
              }
            ]
          },
          "outputs": {},
          "metadata": {},
          "script": {
            "name": "regular-to-json",
            "image": "dellnoantechnp/git-yq:2.42",
            "command": [
              "bash",
              "-e"
            ],
            "env": [
              {
                "name": "MAVEN_BUILD_PROJECT_DIR_FILE",
                "value": "{{workflow.parameters.MAVEN_BUILD_PROJECT_DIR_FILE}}"
              }
            ],
            "resources": {},
            "source": "cat ${MAVEN_BUILD_PROJECT_DIR_FILE} | jq -MRn '[inputs]|map(split(\" \") | {\"app\":.[0],\"dir\":.[1],\"jar_path\":.[2],\"appname\":.[3]})'\n"
          }
        },
        {
          "name": "container",
          "inputs": {
            "parameters": [
              {
                "name": "APPNAME"
              },
              {
                "name": "CONTEXT_ROOT"
              },
              {
                "name": "CI_REGISTRY_URL"
              },
              {
                "name": "REGISTRY_CREDENTIAL_SECRET_NAME"
              },
              {
                "name": "CI_COMMIT_SHORT_SHA"
              },
              {
                "name": "CI_ENVIRONMENT_NAME",
                "value": "{{workflow.outputs.parameters.CI_ENVIRONMENT_NAME}}"
              },
              {
                "name": "CONTAINER_PLATFORM"
              },
              {
                "name": "PUSH_RETRY",
                "value": "5"
              }
            ]
          },
          "outputs": {},
          "metadata": {},
          "container": {
            "name": "podman",
            "image": "quay.io/podman/stable:v5",
            "command": [
              "bash",
              "-ec"
            ],
            "args": [
              "## 这个任务的 stdout 必须为一个有效 JSON 序列，所以需要将其他 stdout 全部重定向至 stderr \nREPO_NAME=${CI_REGISTRY_URL%/}/${APPNAME}\nTAG_NAME=${CI_ENVIRONMENT_NAME}-${CI_COMMIT_SHORT_SHA}\nIMAGE_NAME=\"${REPO_NAME}:${TAG_NAME}\"\nIMAGE_NAME=$(echo ${IMAGE_NAME} | tr '[:upper:]' '[:lower:]')     # 合规小写字符 lowercase\nIMAGE_NAME=${IMAGE_NAME#*//}                                      # truncate  http://  https:// \necho -e \"\\x1b[36mINFO\\x1b[0m: 开始使用 ${CONTEXT_ROOT}/Dockerfile.${CI_ENVIRONMENT_NAME} build images ${IMAGE_NAME} \\x1b[90m...\\x1b[0m\" > /dev/stderr 2>&1\npodman build --tag \"${IMAGE_NAME}\" --platform \"${CONTAINER_PLATFORM}\" --iidfile iid.txt --file  Dockerfile.${CI_ENVIRONMENT_NAME} \"${CONTEXT_ROOT}\" > /dev/stderr 2>&1 && \\\npodman push \"${IMAGE_NAME}\" --digestfile pushdigest.txt > /dev/stderr 2>&1 && \\\nIMAGE_NAME_DIGEST=\"${IMAGE_NAME}@$(cat pushdigest.txt)\" \\\n#/kaniko/executor --context \"${CONTEXT_ROOT}\" --dockerfile Dockerfile.${CI_ENVIRONMENT_NAME} \\\n#  --image-download-retry 3 \\\n#  --push-retry 3 \\\n#  --destination \"${IMAGE_NAME}\"  \\\n#  --reproducible \\\n#  --cache=true \\\n#  --cache-ttl=72h \\\n#  --cache-repo=${IMAGE_NAME%%/*}/kaniko_caches \\\n#  --push-retry=\"${PUSH_RETRY}\" \\\n#  --custom-platform=\"${CONTAINER_PLATFORM}\"\n\nif [[ $(podman images -n ${IMAGE_NAME} | wc -l) -ge 1 ]]; then\n  echo \"INFO: Image build & push complete.\" > /dev/stderr 2>&1\n  podman images ${IMAGE_NAME} > /dev/stderr 2>&1\n  cat <<EOF\n{\n  \"APPNAME\": \"${APPNAME}\",\n  \"CONTEXT_ROOT\": \"${CONTEXT_ROOT}\",\n  \"CI_ENVIRONMENT_NAME\": \"${CI_ENVIRONMENT_NAME}\",\n  \"IMAGE_NAME\": \"${IMAGE_NAME}\",\n  \"IMAGE_NAME_DIGEST\": \"${IMAGE_NAME_DIGEST}\",\n  \"CI_COMMIT_SHORT_SHA\": \"${CI_COMMIT_SHORT_SHA}\",\n  \"Container_platform\": \"${CONTAINER_PLATFORM}\"\n}\nEOF\nelse\n  echo \"ERROR: Image build failed.\"\n  false\nfi\n"
            ],
            "workingDir": "/workspace",
            "env": [
              {
                "name": "APPNAME",
                "value": "{{inputs.parameters.APPNAME}}"
              },
              {
                "name": "CONTEXT_ROOT",
                "value": "{{inputs.parameters.CONTEXT_ROOT}}"
              },
              {
                "name": "CI_REGISTRY_URL",
                "value": "{{inputs.parameters.CI_REGISTRY_URL}}"
              },
              {
                "name": "CI_COMMIT_SHORT_SHA",
                "value": "{{inputs.parameters.CI_COMMIT_SHORT_SHA}}"
              },
              {
                "name": "CI_ENVIRONMENT_NAME",
                "value": "{{inputs.parameters.CI_ENVIRONMENT_NAME}}"
              },
              {
                "name": "CONTAINER_PLATFORM",
                "value": "{{inputs.parameters.CONTAINER_PLATFORM}}"
              },
              {
                "name": "PUSH_RETRY",
                "value": "{{inputs.parameters.PUSH_RETRY}}"
              },
              {
                "name": "REGISTRY_USER",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "{{inputs.parameters.REGISTRY_CREDENTIAL_SECRET_NAME}}",
                    "key": "REGISTRY_USER"
                  }
                }
              },
              {
                "name": "REGISTRY_PASSWORD",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "{{inputs.parameters.REGISTRY_CREDENTIAL_SECRET_NAME}}",
                    "key": "REGISTRY_PASSWORD"
                  }
                }
              }
            ],
            "resources": {
              "limits": {
                "cpu": "4",
                "memory": "1500Mi"
              },
              "requests": {
                "cpu": "500m",
                "memory": "800Mi"
              }
            },
            "volumeMounts": [
              {
                "name": "workspace",
                "mountPath": "/workspace"
              },
              {
                "name": "config-json",
                "mountPath": "/run/containers/0/"
              }
            ],
            "securityContext": {
              "privileged": true
            }
          },
          "volumes": [
            {
              "name": "config-json",
              "emptyDir": {}
            }
          ],
          "initContainers": [
            {
              "name": "registry-login",
              "image": "docker:cli",
              "command": [
                "sh",
                "-ec"
              ],
              "args": [
                "docker login --username ${REGISTRY_USER} --password ${REGISTRY_PASSWORD} {{inputs.parameters.CI_REGISTRY_URL}}\ncp /root/.docker/config.json /run/containers/0/auth.json\n"
              ],
              "env": [
                {
                  "name": "REGISTRY_USER",
                  "valueFrom": {
                    "secretKeyRef": {
                      "name": "{{inputs.parameters.REGISTRY_CREDENTIAL_SECRET_NAME}}",
                      "key": "REGISTRY_USER"
                    }
                  }
                },
                {
                  "name": "REGISTRY_PASSWORD",
                  "valueFrom": {
                    "secretKeyRef": {
                      "name": "{{inputs.parameters.REGISTRY_CREDENTIAL_SECRET_NAME}}",
                      "key": "REGISTRY_PASSWORD"
                    }
                  }
                }
              ],
              "resources": {},
              "volumeMounts": [
                {
                  "name": "config-json",
                  "mountPath": "/run/containers/0/"
                }
              ]
            }
          ]
        },
        {
          "name": "sync-deploy",
          "inputs": {
            "parameters": [
              {
                "name": "GIT_DEPLOY_REPOSITORY_URL"
              },
              {
                "name": "CI_ENVIRONMENT_NAME",
                "value": "{{workflow.outputs.parameters.CI_COMMIT_SHORT_SHA}}"
              },
              {
                "name": "GIT_REPOSITORY_URL",
                "value": "{{workflow.parameters.GIT_REPOSITORY_URL}}"
              },
              {
                "name": "GIT_DEPLOY_BRANCH_NAME",
                "value": "main"
              },
              {
                "name": "aggregate-results"
              }
            ]
          },
          "outputs": {},
          "metadata": {},
          "script": {
            "name": "git-yq",
            "image": "dellnoantechnp/git-yq:2.44",
            "command": [
              "bash",
              "-e"
            ],
            "workingDir": "/workspace",
            "env": [
              {
                "name": "CI_ENVIRONMENT_NAME",
                "value": "{{inputs.parameters.CI_ENVIRONMENT_NAME}}"
              },
              {
                "name": "GIT_USER",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "git-deploy-repository-credential",
                    "key": "GIT_USER"
                  }
                }
              },
              {
                "name": "GIT_PASSWORD",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "git-deploy-repository-credential",
                    "key": "GIT_PASSWORD"
                  }
                }
              },
              {
                "name": "GIT_CREDENTIAL_TYPE",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "git-deploy-repository-credential",
                    "key": "GIT_CREDENTIAL_TYPE"
                  }
                }
              },
              {
                "name": "GIT_SSH_PRIVATEKEY",
                "valueFrom": {
                  "secretKeyRef": {
                    "name": "git-deploy-repository-credential",
                    "key": "GIT_SSH_PRIVATEKEY",
                    "optional": true
                  }
                }
              }
            ],
            "resources": {},
            "volumeMounts": [
              {
                "name": "workspace",
                "mountPath": "/workspace"
              }
            ],
            "source": "## Login settings\ncase \"${GIT_CREDENTIAL_TYPE}\" in\n  SSH|ssh)\n    echo \"INFO: git clone method by [SSH]\"\n    (umask 077 ; echo \"${GIT_SSH_PRIVATEKEY}\" > /git_key)\n    git config --global core.sshCommand 'ssh -i /git_key -o StrictHostKeyChecking=false'\n  ;;\n  *)\n    # https://git-scm.com/docs/gitcredentials store password\n    echo \"INFO: git clone method by [HTTPS]\"\n    git config --global credential.\"{{inputs.parameters.GIT_DEPLOY_REPOSITORY_URL}}\".username \"${GIT_USER}\"\n    git config --global credential.\"{{inputs.parameters.GIT_DEPLOY_REPOSITORY_URL}}\".helper '!p(){ echo \"password=\"${GIT_PASSWORD}\"\";}; p'\n  ;;\nesac\ngit config --global user.name Robot\ngit config --global user.email robot@lerjin.com\n# 清理 deploy 目录，避免冲突\n[[ -d deploy ]] && rm -rf deploy\necho \">_ git clone --branch \"{{inputs.parameters.GIT_DEPLOY_BRANCH_NAME}}\" \"{{inputs.parameters.GIT_DEPLOY_REPOSITORY_URL}}\" deploy\"\ngit clone --branch \"{{inputs.parameters.GIT_DEPLOY_BRANCH_NAME}}\" \"{{inputs.parameters.GIT_DEPLOY_REPOSITORY_URL}}\" deploy\n\n_jq() {\n  ## jq 获取指定字段值\n  echo ${row} | base64 -d | jq -r ${1}\n}\n_sc() {\n  ## console 输出文字颜色标注\n  local regex_pattern=\"$1\"\n  sed \"s@\\(${regex_pattern}\\)@\\x1b[31m\\1\\x1b[0m@\" $2\n}\ncd deploy/\nfor row in $(echo '{{inputs.parameters.aggregate-results}}' | jq -r '.[] | @base64'); do\n  APPNAME=$(_jq '.APPNAME')\n  CONTEXT_ROOT=$(_jq '.CONTEXT_ROOT')\n  CI_ENVIRONMENT_NAME=$(_jq '.CI_ENVIRONMENT_NAME')\n  IMAGE_NAME=$(_jq '.IMAGE_NAME')\n  IMAGE_NAME_DIGEST=$(_jq '.IMAGE_NAME_DIGEST')\n  CI_COMMIT_SHORT_SHA=$(_jq '.CI_COMMIT_SHORT_SHA')\n  #APP_RESOURCE_DEFINE_FILE_PATH=\"overlays/${CI_ENVIRONMENT_NAME}/deploy/${APPNAME}.yaml\"\n  APP_RESOURCE_DEFINE_FILE_PATH=\"overlays/${CI_ENVIRONMENT_NAME}/${APPNAME}.yaml\"\n  yq -i '(select(.kind == \"Deployment\") | .spec.template.spec.containers[] | select(.name == \"'${APPNAME}'\")) .image = \"'${IMAGE_NAME_DIGEST}'\"' ${APP_RESOURCE_DEFINE_FILE_PATH}\n  yq -i '(select(.kind == \"Deployment\") | .spec.template.metadata.labels.version) = \"'${CI_COMMIT_SHORT_SHA}'\"' ${APP_RESOURCE_DEFINE_FILE_PATH}\n  _sc \"${IMAGE_NAME}\" ${APP_RESOURCE_DEFINE_FILE_PATH}\n  grep \"${IMAGE_NAME}\" ${APP_RESOURCE_DEFINE_FILE_PATH} > /dev/null 2>&1 && CURRENT_STAT=\"${CURRENT_STAT}./${CONTEXT_ROOT} -> ${APPNAME} \\x1b[32mSuccess\\x1b[0m\\n\" || CURRENT_STAT=\"${CURRENT_STAT}./${CONTEXT_ROOT} -> ${APPNAME} \\x1b[31mFailed\\x1b[0m\\n\" \n  printf \"\\n%-40s\\n\" \"=\"|sed \"s/ /=/g\"\ndone\n\necho \"======= sync-deploy information ========\"\necho -e \"${CURRENT_STAT}\" | column -t\n\ngit commit -sa -m \"[WorkflowRobot]: Push back from {{inputs.parameters.GIT_REPOSITORY_URL}}\" && \\\ngit pull --rebase=true && git push && \\\ngit credential-cache exit\n"
          }
        }
      ],
      "entrypoint": "main",
      "arguments": {
        "parameters": [
          {
            "name": "_MANUAL_",
            "value": "false",
            "description": "是否进行全量发布"
          },
          {
            "name": "GIT_REPOSITORY_URL",
            "value": "https://gitlab.fawve.cluster.ws/fawve/finance.git",
            "description": "源码仓库地址,此值通过sensor进行注入"
          },
          {
            "name": "GIT_PUSH_REF",
            "value": "main",
            "description": "触发任务的分支"
          },
          {
            "name": "PREVIOUS_CHECKOUT_SHA",
            "value": "",
            "description": "上一次成功任务的 Git Checkout SHA"
          },
          {
            "name": "GIT_REPOSITORY_NAME",
            "value": "finance",
            "description": "仓库名称"
          },
          {
            "name": "GIT_CHECKOUT_SHA",
            "value": "b38758a4d38cd25468a9ab11c888a9b4bbc318b2",
            "description": "本次提交的 SHA"
          },
          {
            "name": "GIT_BEFORE_SHA",
            "value": "d67ea3643e87d813cbd8ff069a3d1e2710cacf57",
            "description": "上一个提交的 SHA"
          },
          {
            "name": "PROJECT_DEPENDENCY_INCLUDE_GROUP_NAME",
            "value": "",
            "description": "对于 MonoRepo 进行依赖检测需要提供统一的 Maven Reactor group name"
          },
          {
            "name": "MAVEN_BUILD_PROJECT_DIR_FILE",
            "value": "/workspace/BUILD.txt",
            "description": "临时文件"
          },
          {
            "name": "CI_ENVIRONMENT_NAME",
            "value": "main",
            "description": "环境名称,此值通过GIT_PUSH_REF进行覆盖,分支即环境"
          },
          {
            "name": "CI_REGISTRY_URL",
            "value": "https://registry.fawve.cluster.ws",
            "description": "容器镜像 Registry URL"
          },
          {
            "name": "REGISTRY_CREDENTIAL_SECRET_NAME",
            "value": "container-registry-credential",
            "description": "容器镜像仓库的认证信息 Secret"
          },
          {
            "name": "CONTAINER_PLATFORM",
            "value": "linux/arm64",
            "description": "平台 linux/amd64  linux/arm64"
          },
          {
            "name": "GIT_DEPLOY_REPOSITORY_URL",
            "value": "https://gitlab.fawve.cluster.ws/fawve/deploy.git",
            "description": "发布仓库"
          },
          {
            "name": "WORKFLOWS_API_DOMAIN",
            "value": "workflows.fawve.cluster.ws",
            "description": "workflows server 外部域名"
          },
          {
            "name": "WORKFLOWS_API_NAMESPACE",
            "value": "workflows",
            "description": "workflows API 即任务名称空间"
          },
          {
            "name": "WORKFLOWS_API_PROJECT_ID",
            "value": "7",
            "description": "workflows API 任务的 Project ID"
          },
          {
            "name": "WORKFLOWS_API_REPOSITORY",
            "value": "finance",
            "description": "workflows API 项目代码仓库"
          },
          {
            "name": "WORKFLOWS_API_BRANCH",
            "value": "main",
            "description": "workflows API 项目代码分支"
          },
          {
            "name": "TRIGGER_WORKFLOWS_JOB_AUTHOR",
            "value": "Eric",
            "description": "git提交的提交人员"
          },
          {
            "name": "CI_DEBUG_TRACE",
            "value": "false",
            "description": "任务执行 debug mode"
          },
          {
            "name": "GIT_DEPLOY_BRANCH_NAME",
            "value": "main",
            "description": "发布仓库主分支"
          },
          {
            "name": "NOTIFICATION_DINGTALK_BOT_ADDR",
            "value": "http://dingtalk-bot.argo-workflows.svc.cluster.local:8000",
            "description": "DingTalk Bot 机器人的调用域名"
          },
          {
            "name": "NOTIFICATION_CARD_TEMPLATE_ID",
            "value": "98a61096-31e1-4611-be4e-b1d2f6897225.schema",
            "description": "互动卡片模板ID"
          },
          {
            "name": "NOTIFICATION_OPEN_CONVERSATION_ID",
            "value": "cidUQXUpOwFEbiRNp87JyFE3w==",
            "description": "互动卡片群组ID"
          }
        ]
      },
      "serviceAccountName": "argo-workflow",
      "volumes": [
        {
          "name": "maven-settings",
          "configMap": {
            "name": "maven-settings"
          }
        },
        {
          "name": "maven-repository-cache",
          "persistentVolumeClaim": {
            "claimName": "maven-repository-cache"
          }
        },
        {
          "name": "argo-workflows-operator-token",
          "secret": {
            "secretName": "argo-workflow-operate-sa-token",
            "optional": true
          }
        }
      ],
      "volumeClaimTemplates": [
        {
          "metadata": {
            "name": "workspace",
            "creationTimestamp": null
          },
          "spec": {
            "accessModes": [
              "ReadWriteMany"
            ],
            "resources": {
              "requests": {
                "storage": "8Gi"
              }
            },
            "storageClassName": "nfs-client"
          },
          "status": {}
        }
      ],
      "imagePullSecrets": [
        {
          "name": "docker-registry-secret"
        }
      ],
      "ttlStrategy": {
        "secondsAfterCompletion": 5184000
      },
      "activeDeadlineSeconds": 28800,
      "podGC": {
        "strategy": "OnPodSuccess"
      },
      "shutdown": "Terminate",
      "workflowTemplateRef": {
        "name": "ci-java-jagat"
      }
    },
    "artifactRepositoryRef": {
      "default": true,
      "artifactRepository": {
        "archiveLogs": true,
        "s3": {
          "endpoint": "minio.minio.svc.cluster.local:9000",
          "bucket": "argo-bucket",
          "region": "home",
          "insecure": true,
          "accessKeySecret": {
            "name": "minio-workflows-secret",
            "key": "accesskey"
          },
          "secretKeySecret": {
            "name": "minio-workflows-secret",
            "key": "secretkey"
          }
        }
      }
    },
    "artifactGCStatus": {
      "notSpecified": true
    },
    "taskResultsCompletionStatus": {
      "cicd-java-main-finance-b38758a4-hhjbb-2131133452": true,
      "cicd-java-main-finance-b38758a4-hhjbb-2449782576": true,
      "cicd-java-main-finance-b38758a4-hhjbb-2553748563": true,
      "cicd-java-main-finance-b38758a4-hhjbb-2561201363": true,
      "cicd-java-main-finance-b38758a4-hhjbb-258446681": true,
      "cicd-java-main-finance-b38758a4-hhjbb-2775002877": true,
      "cicd-java-main-finance-b38758a4-hhjbb-3342717902": true,
      "cicd-java-main-finance-b38758a4-hhjbb-3369515995": true,
      "cicd-java-main-finance-b38758a4-hhjbb-359253584": true,
      "cicd-java-main-finance-b38758a4-hhjbb-3883381747": true,
      "cicd-java-main-finance-b38758a4-hhjbb-4034592005": true
    }
  }
}